<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookings - Roomhy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        .sidebar { background-color: #111827; color: #9ca3af; }
        .sidebar-link { color: #9ca3af; font-weight: 500; transition: all 0.2s; display: flex; align-items: center; padding: 0.75rem 1.5rem; font-size: 0.9rem; border-left: 3px solid transparent; cursor: pointer; }
        .sidebar-link:hover { color: #f3f4f6; background-color: #1f2937; }
        .sidebar-link.active { background-color: #1f2937; color: #ffffff; border-left-color: #a855f7; }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 4px; }
    </style>
</head>
<body class="text-slate-800">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="sidebar w-72 flex-shrink-0 hidden md:flex flex-col z-20 overflow-y-auto custom-scrollbar">
            <div class="h-16 flex items-center px-6 border-b border-gray-800 sticky top-0 bg-[#111827] z-10">
                 <div class="flex items-center gap-3">
                     <div class="bg-purple-600 p-1.5 rounded-lg"><i data-lucide="home" class="w-5 h-5 text-white"></i></div>
                     <div><h1 class="text-xl font-bold text-white">RoomHy</h1><span class="text-[10px] text-gray-500">OWNER PANEL</span></div>
                 </div>
            </div>
            <nav class="flex-1 py-6 space-y-1">
                <a href="admin.html" class="sidebar-link"><i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i> Dashboard</a>
                <a href="properties.html" class="sidebar-link"><i data-lucide="building" class="w-5 h-5 mr-3"></i> Properties</a>
                <a href="rooms.html" class="sidebar-link"><i data-lucide="bed-double" class="w-5 h-5 mr-3"></i> Rooms</a>
                <a href="tenantrec.html" class="sidebar-link"><i data-lucide="clipboard-list" class="w-5 h-5 mr-3"></i> Tenant Records</a>
                <a href="enquiry.html" class="sidebar-link"><i data-lucide="mail" class="w-5 h-5 mr-3"></i> Enquiry</a>
                <a href="documents.html" class="sidebar-link"><i data-lucide="file-text" class="w-5 h-5 mr-3"></i> Documents</a>
                <a href="payment.html" class="sidebar-link"><i data-lucide="credit-card" class="w-5 h-5 mr-3"></i> Payments</a>
                <a href="booking_request.html" class="sidebar-link"><i data-lucide="calendar-check" class="w-5 h-5 mr-3"></i> Booking Requests</a>
                <a href="booking.html" class="sidebar-link active"><i data-lucide="book-open" class="w-5 h-5 mr-3"></i> Bookings</a>
                <a href="ownerchat.html" class="sidebar-link"><i data-lucide="message-circle" class="w-5 h-5 mr-3"></i> Chat</a>
                <a href="complaints.html" class="sidebar-link"><i data-lucide="alert-circle" class="w-5 h-5 mr-3"></i> Complaints</a>
                <a href="location.html" class="sidebar-link"><i data-lucide="map-pin" class="w-5 h-5 mr-3"></i> Location</a>
                <a href="ownerprofile.html" class="sidebar-link"><i data-lucide="user" class="w-5 h-5 mr-3"></i> Profile</a>
                <a href="settings.html" class="sidebar-link"><i data-lucide="settings" class="w-5 h-5 mr-3"></i> Settings</a>
            </nav>
        </aside>

        <div class="flex-1 flex flex-col overflow-hidden bg-[#f3f4f6]">
            <header class="bg-white h-16 flex items-center justify-between px-6 shadow-sm z-10">
                <div class="flex items-center">
                    <button id="mobile-menu-open" class="md:hidden mr-4 text-slate-500"><i data-lucide="menu" class="w-6 h-6"></i></button>
                    <h2 class="text-lg font-semibold text-slate-800">Confirmed Bookings</h2>
                </div>
                <div class="flex items-center gap-4">
                    <button class="text-slate-400 hover:text-slate-600"><i data-lucide="bell" class="w-5 h-5"></i></button>
                    <div class="relative group">
                        <button class="flex items-center gap-3 hover:bg-gray-50 p-1.5 rounded-full transition-colors">
                            <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 font-bold border border-purple-200" id="headerAvatar">OP</div>
                            <div class="text-left hidden sm:block">
                                <p class="text-xs font-semibold text-gray-700" id="headerName">Owner</p>
                                <p class="text-[10px] text-gray-500" id="headerAccountId">Property Owner</p>
                            </div>
                            <i data-lucide="chevron-down" class="w-3 h-3 text-gray-400 hidden sm:block"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Mobile Sidebar -->
            <div id="mobile-menu" class="md:hidden fixed inset-0 z-50 flex hidden">
                <div class="fixed inset-0 bg-black/30 backdrop-blur-sm" id="mobile-menu-overlay"></div>
                <aside class="sidebar w-72 flex-shrink-0 text-gray-300 flex flex-col relative z-10 ml-auto">
                    <div class="h-16 flex items-center justify-between px-6 border-b border-gray-800">
                        <div class="flex items-center gap-3">
                            <div class="bg-purple-600 p-1.5 rounded-lg"><i data-lucide="home" class="w-5 h-5 text-white"></i></div>
                            <div><h1 class="text-xl font-bold text-white">RoomHy</h1><span class="text-[10px] text-gray-500">OWNER PANEL</span></div>
                        </div>
                        <button id="close-mobile-menu" class="p-2 text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
                    </div>
                    <nav class="flex-1 py-6 space-y-1">
                        <a href="admin.html" class="sidebar-link"><i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i> Dashboard</a>
                        <a href="properties.html" class="sidebar-link"><i data-lucide="building" class="w-5 h-5 mr-3"></i> Properties</a>
                        <a href="rooms.html" class="sidebar-link"><i data-lucide="bed-double" class="w-5 h-5 mr-3"></i> Rooms</a>
                        <a href="tenantrec.html" class="sidebar-link"><i data-lucide="clipboard-list" class="w-5 h-5 mr-3"></i> Tenant Records</a>
                        <a href="enquiry.html" class="sidebar-link"><i data-lucide="mail" class="w-5 h-5 mr-3"></i> Enquiry</a>
                        <a href="documents.html" class="sidebar-link"><i data-lucide="file-text" class="w-5 h-5 mr-3"></i> Documents</a>
                        <a href="payment.html" class="sidebar-link"><i data-lucide="credit-card" class="w-5 h-5 mr-3"></i> Payments</a>
                        <a href="booking_request.html" class="sidebar-link"><i data-lucide="calendar-check" class="w-5 h-5 mr-3"></i> Booking Requests</a>
                        <a href="booking.html" class="sidebar-link active"><i data-lucide="book-open" class="w-5 h-5 mr-3"></i> Bookings</a>
                        <a href="ownerchat.html" class="sidebar-link"><i data-lucide="message-circle" class="w-5 h-5 mr-3"></i> Chat</a>
                        <a href="complaints.html" class="sidebar-link"><i data-lucide="alert-circle" class="w-5 h-5 mr-3"></i> Complaints</a>
                        <a href="location.html" class="sidebar-link"><i data-lucide="map-pin" class="w-5 h-5 mr-3"></i> Location</a>
                        <a href="ownerprofile.html" class="sidebar-link"><i data-lucide="user" class="w-5 h-5 mr-3"></i> Profile</a>
                        <a href="settings.html" class="sidebar-link"><i data-lucide="settings" class="w-5 h-5 mr-3"></i> Settings</a>
                    </nav>
                </aside>
            </div>

            <main class="flex-1 overflow-y-auto p-8">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 flex items-center gap-3">
                        <i data-lucide="book-open" class="w-8 h-8 text-purple-600"></i>
                        Confirmed Bookings
                    </h1>
                    <p class="text-gray-600 mt-2">Bookings where both parties have agreed</p>
                </div>

                <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse">
                            <thead class="bg-gray-50 border-b border-gray-200 sticky top-0">
                                <tr class="text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">
                                    <th class="px-4 py-3 whitespace-nowrap">Property</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Tenant</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Contact</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Rent</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Visit Date</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Status</th>
                                    <th class="px-4 py-3 whitespace-nowrap">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="bookingsTableBody" class="divide-y divide-gray-200">
                                <tr class="text-center py-8 text-gray-500">
                                    <td colspan="7" class="py-8">
                                        <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-3 opacity-50"></i>
                                        <p>Loading bookings...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        let currentOwner = null;

        // Load owner session
        async function loadOwner() {
            const owner = JSON.parse(sessionStorage.getItem('owner_user') || localStorage.getItem('user') || 'null');
            if (owner) {
                currentOwner = owner;
                const ownerId = owner.loginId || owner.ownerId || '...';
                const ownerName = owner.name || owner.ownerName || 'Owner';
                
                document.getElementById('headerName').textContent = ownerName;
                document.getElementById('headerAccountId').textContent = `ID: ${ownerId}`;
                document.getElementById('headerAvatar').textContent = ownerName.charAt(0).toUpperCase();
                
                loadBookings();
            } else {
                window.location.href = 'ownerlogin.html';
            }
        }

        // Load confirmed bookings
        async function loadBookings() {
            if (!currentOwner) return;
            const ownerId = currentOwner.loginId || currentOwner.ownerId;
            const API_URL = 'https://roomhy-backend-wqwo.onrender.com';

            try {
                const response = await fetch(`${API_URL}/api/booking/requests?owner_id=${ownerId}&status=confirmed`);
                const data = await response.json();
                const bookings = data.data || [];

                const tableBody = document.getElementById('bookingsTableBody');
                
                if (bookings.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="7" class="py-8 text-center text-gray-500">
                                <i data-lucide="inbox" class="w-12 h-12 mx-auto mb-3 opacity-50"></i>
                                <p>No confirmed bookings yet</p>
                            </td>
                        </tr>
                    `;
                    lucide.createIcons();
                    return;
                }

                tableBody.innerHTML = bookings.map(booking => `
                    <tr class="hover:bg-gray-50 text-sm border-b border-gray-200">
                        <td class="px-4 py-3">
                            <div>
                                <p class="font-medium text-gray-900">${booking.property_name || 'N/A'}</p>
                                <p class="text-xs text-gray-500">${booking.area || 'N/A'}</p>
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <div>
                                <p class="font-medium text-gray-900">${booking.name || 'N/A'}</p>
                                <p class="text-xs text-gray-500">ID: ${booking.user_id || 'N/A'}</p>
                            </div>
                        </td>
                        <td class="px-4 py-3 text-gray-600">
                            <p>${booking.phone || 'N/A'}</p>
                            <p class="text-xs">${booking.email || 'N/A'}</p>
                        </td>
                        <td class="px-4 py-3 text-gray-900 font-semibold">₹${booking.rent_amount || 0}</td>
                        <td class="px-4 py-3 text-gray-600">
                            ${booking.visit_date ? new Date(booking.visit_date).toLocaleDateString() : 'Not scheduled'}
                            ${booking.visit_time_slot ? `<br><span class="text-xs">${booking.visit_time_slot}</span>` : ''}
                        </td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">
                                Confirmed
                            </span>
                        </td>
                        <td class="px-4 py-3">
                            <button onclick="viewDetails('${booking._id}')" class="px-3 py-1 rounded bg-blue-100 text-blue-700 text-sm">View Details</button>
                        </td>
                    </tr>
                `).join('');

                lucide.createIcons();
            } catch (err) {
                console.error("Error loading bookings", err);
                document.getElementById('bookingsTableBody').innerHTML = `
                    <tr>
                        <td colspan="7" class="py-8 text-center text-red-500">
                            <i data-lucide="alert-circle" class="w-12 h-12 mx-auto mb-3"></i>
                            <p>Error loading bookings</p>
                        </td>
                    </tr>
                `;
                lucide.createIcons();
            }
        }

        function viewDetails(bookingId) {
            // Could open a modal or redirect to detail page
            alert('Booking details for ID: ' + bookingId);
        }

        // Mobile menu handlers
        document.getElementById('mobile-menu-open').addEventListener('click', () => {
            document.getElementById('mobile-menu').classList.remove('hidden');
        });

        document.getElementById('close-mobile-menu').addEventListener('click', () => {
            document.getElementById('mobile-menu').classList.add('hidden');
        });

        document.getElementById('mobile-menu-overlay').addEventListener('click', () => {
            document.getElementById('mobile-menu').classList.add('hidden');
        });

        // Initialize
        loadOwner();
    </script>
</body>
</html>