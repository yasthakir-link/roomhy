<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roomhy - Website Property Enquiries</title>
    <script>
        // API Configuration
        const API_URL = 'https://roomhy-backend-wqwo.onrender.com';
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        
        .sidebar {
            background-color: #111827;
            color: #9ca3af;
        }
        .sidebar-link {
            color: #9ca3af;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            font-size: 0.9rem;
            border-left: 3px solid transparent;
            cursor: pointer;
        }
        .sidebar-link:hover {
            color: #f3f4f6; 
            background-color: #1f2937;
        }
        .sidebar-link.active {
            background-color: #1f2937;
            color: #ffffff;
            border-left-color: #a855f7;
        }

        .data-table th {
            background-color: #f9fafb;
            color: #6b7280;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.75rem 1.5rem;
            text-align: left;
        }
        .data-table td {
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem 1.5rem;
            font-size: 0.875rem;
            color: #1f2937;
        }
        .data-table tr:hover td {
            background-color: #f9fafb;
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 4px;
        }

        .modal { 
            transition: opacity 0.25s ease; 
        }
        
        .area-section {
            margin-bottom: 2rem;
        }
        
        .area-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="text-slate-800">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="sidebar w-72 flex-shrink-0 hidden md:flex flex-col z-20 overflow-y-auto custom-scrollbar">
            <div class="h-16 flex items-center px-6 border-b border-gray-800 sticky top-0 bg-[#111827] z-10">
                <div class="flex items-center gap-3">
                    <div class="bg-purple-600 p-1.5 rounded-lg"><i data-lucide="building-2" class="w-5 h-5 text-white"></i></div>
                    <div><h1 class="text-xl font-bold text-white">RoomHy</h1><span class="text-[10px] text-gray-500">SUPER ADMIN</span></div>
                </div>
            </div>
            <nav class="flex-1 py-6 space-y-1">
                <div class="px-6 pb-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">Overview</div>
                <a href="superadmin.html" class="sidebar-link"><i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i> Dashboard</a>
                <div class="mt-6 px-6 pb-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">Management</div>
                <a href="manager.html" class="sidebar-link"><i data-lucide="map-pin" class="w-5 h-5 mr-3"></i> Teams</a>
                <a href="owner.html" class="sidebar-link"><i data-lucide="briefcase" class="w-5 h-5 mr-3"></i> Property Owners</a>
                <a href="properties.html" class="sidebar-link"><i data-lucide="home" class="w-5 h-5 mr-3"></i> Properties</a>
                <a href="tenant.html" class="sidebar-link"><i data-lucide="users" class="w-5 h-5 mr-3"></i> Tenants</a>
                <a href="new_signups.html" class="sidebar-link"><i data-lucide="file-badge" class="w-5 h-5 mr-3"></i> New Signups</a>
                <div class="mt-6 px-6 pb-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">Operations</div>
                <a href="enquiry.html" class="sidebar-link"><i data-lucide="help-circle" class="w-5 h-5 mr-3"></i> Enquiries</a>
                <a href="websiteenq.html" class="sidebar-link active"><i data-lucide="globe" class="w-5 h-5 mr-3"></i> Web Enquiry</a>
                <a href="booking.html" class="sidebar-link"><i data-lucide="calendar-check" class="w-5 h-5 mr-3"></i> Bookings</a>
                <a href="reviews.html" class="sidebar-link"><i data-lucide="star" class="w-5 h-5 mr-3"></i> Reviews</a>
                <a href="complaint-history.html" class="sidebar-link"><i data-lucide="alert-circle" class="w-5 h-5 mr-3"></i> Complaint History</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden bg-[#f3f4f6]">
            <!-- Top Header -->
            <header class="bg-white h-16 flex items-center justify-between px-6 shadow-sm z-10">
                <div class="flex items-center">
                    <button id="mobile-menu-open" class="md:hidden mr-4 text-slate-500"><i data-lucide="menu" class="w-6 h-6"></i></button>
                    <div class="flex items-center text-sm">
                        <span class="text-slate-500 font-medium">Operations</span>
                        <i data-lucide="chevron-right" class="w-4 h-4 mx-2 text-slate-400"></i>
                        <span class="text-slate-800 font-semibold">Website Property Enquiries</span>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button class="text-slate-400 hover:text-slate-600"><i data-lucide="bell" class="w-5 h-5"></i></button>
                </div>
            </header>

            <!-- Scrollable Content -->
            <main class="flex-1 overflow-y-auto p-6 md:p-8">
                <div class="max-w-7xl mx-auto">
                    
                    <!-- Page Header -->
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
                        <div>
                            <h1 class="text-2xl font-bold text-slate-800">Property Enquiries from Website</h1>
                            <p class="text-sm text-slate-500 mt-1">Manage and assign property enquiries to area managers.</p>
                        </div>
                    </div>

                    <!-- Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                        <div class="bg-white p-4 rounded-lg border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Total Enquiries</p>
                                    <p class="text-2xl font-bold text-slate-800" id="total-enquiries">0</p>
                                </div>
                                <i data-lucide="inbox" class="w-8 h-8 text-blue-500"></i>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Pending</p>
                                    <p class="text-2xl font-bold text-yellow-600" id="pending-enquiries">0</p>
                                </div>
                                <i data-lucide="clock" class="w-8 h-8 text-yellow-500"></i>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Assigned</p>
                                    <p class="text-2xl font-bold text-green-600" id="assigned-enquiries">0</p>
                                </div>
                                <i data-lucide="check-circle" class="w-8 h-8 text-green-500"></i>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">Cities</p>
                                    <p class="text-2xl font-bold text-purple-600" id="total-cities">0</p>
                                </div>
                                <i data-lucide="map-pin" class="w-8 h-8 text-purple-500"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="bg-white p-4 rounded-lg border border-gray-200 mb-6 shadow-sm">
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="flex-1">
                                <input type="text" id="search-input" placeholder="Search property name, owner, locality..." 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <select id="status-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="assigned">Assigned</option>
                            </select>
                            <select id="city-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="">All Cities</option>
                            </select>
                        </div>
                    </div>

                    <!-- Enquiries Container -->
                    <div id="enquiries-container" class="space-y-6">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Details Modal -->
    <div id="details-modal" class="modal fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center sticky top-0 bg-white">
                <h2 class="text-xl font-bold">Property Details</h2>
                <button onclick="closeDetailsModal()" class="text-gray-400 hover:text-gray-600"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div id="details-content" class="p-6 space-y-4">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Assignment Modal -->
    <div id="assignment-modal" class="modal fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg max-w-md w-full mx-4">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h2 class="text-xl font-bold">Assign to Employee</h2>
                <button onclick="closeAssignmentModal()" class="text-gray-400 hover:text-gray-600"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <input type="hidden" id="modal-enquiry-id">
                <div>
                    <label class="block text-sm font-medium mb-2">Select Employee</label>
                    <select id="manager-select" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <option value="">Choose Employee...</option>
                    </select>
                </div>
                <div class="flex gap-2 pt-4">
                    <button onclick="confirmAssignment()" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg font-medium">Assign</button>
                    <button onclick="closeAssignmentModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 rounded-lg font-medium">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="fixed inset-0 bg-black/50 z-30 hidden backdrop-blur-sm" onclick="toggleMobileMenu()"></div>

    <script>
        lucide.createIcons();

        let allEnquiries = [];
        let filteredEnquiries = [];
        let managers = [];

        // Load enquiries from MongoDB via API
        async function loadEnquiries() {
            try {
                const response = await fetch(API_URL + '/api/website-enquiry/all');
                const result = await response.json();

                if (result.success) {
                    allEnquiries = result.enquiries.map(e => ({
                        id: e.enquiry_id,
                        property_type: e.property_type,
                        property_name: e.property_name,
                        city: e.city,
                        locality: e.locality,
                        address: e.address,
                        pincode: e.pincode,
                        description: e.description,
                        amenities: e.amenities,
                        gender_suitability: e.gender_suitability,
                        rent: e.rent,
                        deposit: e.deposit,
                        owner_name: e.owner_name,
                        owner_email: e.owner_email,
                        owner_phone: e.owner_phone,
                        status: e.status,
                        assigned_to: e.assigned_to,
                        assigned_area: e.assigned_area,
                        notes: e.notes,
                        created_at: e.created_at
                    }));
                    console.log('Enquiries loaded:', allEnquiries);
                } else {
                    console.error('Failed to fetch enquiries:', result.message);
                    allEnquiries = [];
                }
            } catch (error) {
                console.error('Error loading enquiries:', error);
                // Load default sample data if API fails
                allEnquiries = [
                    {
                        id: 'sample_1',
                        property_type: 'pg',
                        property_name: 'Sample PG in Kota',
                        city: 'kota',
                        locality: 'North Campus',
                        address: '123 Main Street',
                        pincode: '324001',
                        description: 'Sample property for testing',
                        amenities: ['WiFi', 'AC'],
                        gender_suitability: 'male',
                        rent: 5000,
                        deposit: 10000,
                        owner_name: 'John Doe',
                        owner_email: 'john@example.com',
                        owner_phone: '9876543210',
                        status: 'pending',
                        assigned_to: null,
                        assigned_area: null,
                        notes: '',
                        created_at: new Date().toISOString()
                    },
                    {
                        id: 'sample_2',
                        property_type: 'hostel',
                        property_name: 'Sample Hostel in Indore',
                        city: 'indore',
                        locality: 'City Center',
                        address: '456 Hostel Lane',
                        pincode: '452001',
                        description: 'Another sample property',
                        amenities: ['Food', 'Laundry'],
                        gender_suitability: 'female',
                        rent: 4000,
                        deposit: 8000,
                        owner_name: 'Jane Smith',
                        owner_email: 'jane@example.com',
                        owner_phone: '9876543211',
                        status: 'assigned',
                        assigned_to: 'Rajesh Kumar',
                        assigned_area: 'Indore',
                        notes: 'Assigned for follow-up',
                        created_at: new Date().toISOString()
                    }
                ];
            }

            loadManagers();
            updateStats();
            filterEnquiries();
        }

        // Load employees from backend or localStorage
        function loadManagers() {
            // Try to get employees from localStorage cache (set by manager.html)
            const cachedEmployees = JSON.parse(localStorage.getItem('roomhy_employees_cache') || '[]');
            
            if (cachedEmployees.length > 0) {
                managers = cachedEmployees.map(e => ({
                    id: e.loginId || e.id,
                    name: e.name,
                    area: e.area || e.locationCode || 'Unassigned'
                }));
            } else {
                // Fallback: use hardcoded managers if no data available
                managers = [
                    { id: 1, name: 'Rajesh Kumar', area: 'Indore' },
                    { id: 2, name: 'Priya Singh', area: 'Kota' },
                    { id: 3, name: 'Amit Patel', area: 'Ahmedabad' },
                    { id: 4, name: 'Neha Sharma', area: 'Delhi' }
                ];
            }
            
            const select = document.getElementById('manager-select');
            select.innerHTML = '<option value="">Choose Employee...</option>';
            managers.forEach(m => {
                const option = document.createElement('option');
                option.value = m.id;
                option.textContent = `${m.name} (${m.area})`;
                select.appendChild(option);
            });

            const cityFilter = document.getElementById('city-filter');
            const cities = [...new Set(allEnquiries.map(e => e.city))];
            cities.forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city.charAt(0).toUpperCase() + city.slice(1);
                cityFilter.appendChild(option);
            });
        }

        // Update statistics
        function updateStats() {
            const total = allEnquiries.length;
            const pending = allEnquiries.filter(e => e.status === 'pending').length;
            const assigned = allEnquiries.filter(e => e.status === 'assigned').length;
            const cities = new Set(allEnquiries.map(e => e.city)).size;

            document.getElementById('total-enquiries').textContent = total;
            document.getElementById('pending-enquiries').textContent = pending;
            document.getElementById('assigned-enquiries').textContent = assigned;
            document.getElementById('total-cities').textContent = cities;
        }

        // Filter enquiries
        function filterEnquiries() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const statusFilter = document.getElementById('status-filter').value;
            const cityFilter = document.getElementById('city-filter').value;

            filteredEnquiries = allEnquiries.filter(e => {
                const matchSearch = !searchTerm || 
                    e.property_name.toLowerCase().includes(searchTerm) ||
                    e.owner_name.toLowerCase().includes(searchTerm) ||
                    (e.locality && e.locality.toLowerCase().includes(searchTerm));
                
                const matchStatus = !statusFilter || e.status === statusFilter;
                const matchCity = !cityFilter || e.city === cityFilter;

                return matchSearch && matchStatus && matchCity;
            });

            renderEnquiries();
        }

        // Render enquiries grouped by city
        function renderEnquiries() {
            const container = document.getElementById('enquiries-container');
            
            if (filteredEnquiries.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 py-8">No enquiries found.</p>';
                return;
            }

            const grouped = {};
            filteredEnquiries.forEach(e => {
                if (!grouped[e.city]) grouped[e.city] = [];
                grouped[e.city].push(e);
            });

            let html = '';
            Object.keys(grouped).sort().forEach(city => {
                html += `
                    <div class="area-section">
                        <div class="area-header">
                            <h2 class="text-lg font-semibold flex items-center gap-2">
                                <i data-lucide="map-pin" class="w-5 h-5"></i>
                                ${city.charAt(0).toUpperCase() + city.slice(1)}
                            </h2>
                            <p class="text-sm opacity-90 mt-1">${grouped[city].length} enquiries</p>
                        </div>
                        <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                            <table class="w-full data-table">
                                <thead>
                                    <tr>
                                        <th>Property</th>
                                        <th>Owner</th>
                                        <th>Locality</th>
                                        <th>Type</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${grouped[city].map(e => `
                                        <tr>
                                            <td><strong>${e.property_name}</strong></td>
                                            <td>${e.owner_name}</td>
                                            <td>${e.locality || '-'}</td>
                                            <td>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                    ${(e.property_type || 'Other').toUpperCase()}
                                                </span>
                                            </td>
                                            <td><small>${new Date(e.created_at).toLocaleDateString()}</small></td>
                                            <td>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                                    e.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'
                                                }">
                                                    ${e.status === 'pending' ? 'Pending' : 'Assigned to ' + (e.assigned_to || '?')}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="flex gap-2">
                                                    <button onclick="viewDetails('${e.id}')" class="text-blue-600 hover:text-blue-800 p-1" title="View Details">
                                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                                    </button>
                                                    ${e.status === 'pending' ? `
                                                        <button onclick="openAssignmentModal('${e.id}')" class="text-purple-600 hover:text-purple-800 p-1" title="Assign">
                                                            <i data-lucide="user-check" class="w-4 h-4"></i>
                                                        </button>
                                                    ` : ''}
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            lucide.createIcons();
        }

        // View details
        function viewDetails(id) {
            const enquiry = allEnquiries.find(e => e.id === id);
            if (!enquiry) return;

            const content = document.getElementById('details-content');
            content.innerHTML = `
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-xs text-gray-600">Property Name</p>
                            <p class="font-semibold">${enquiry.property_name}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">Property Type</p>
                            <p class="font-semibold">${enquiry.property_type || 'N/A'}</p>
                        </div>
                    </div>
                    <hr>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-xs text-gray-600">Owner Name</p>
                            <p class="font-semibold">${enquiry.owner_name}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">Owner Email</p>
                            <p class="font-semibold">${enquiry.owner_email || 'N/A'}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">Owner Phone</p>
                            <p class="font-semibold">${enquiry.owner_phone}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">Submitted Date</p>
                            <p class="font-semibold">${new Date(enquiry.created_at).toLocaleString()}</p>
                        </div>
                    </div>
                    <hr>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-xs text-gray-600">City</p>
                            <p class="font-semibold">${enquiry.city.toUpperCase()}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">Locality</p>
                            <p class="font-semibold">${enquiry.locality || 'N/A'}</p>
                        </div>
                        <div class="col-span-2">
                            <p class="text-xs text-gray-600">Full Address</p>
                            <p class="font-semibold">${enquiry.address}, ${enquiry.pincode}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">Gender Suitability</p>
                            <p class="font-semibold capitalize">${enquiry.gender_suitability || 'Any'}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">Starting Price</p>
                            <p class="font-semibold">?${(enquiry.rent || 0).toLocaleString()}/month</p>
                        </div>
                    </div>
                    <hr>
                    <div>
                        <p class="text-xs text-gray-600">Amenities</p>
                        <div class="flex flex-wrap gap-2 mt-2">
                            ${(enquiry.amenities || []).map(a => `<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">${a}</span>`).join('')}
                        </div>
                    </div>
                    ${enquiry.description ? `
                        <div>
                            <p class="text-xs text-gray-600">Description</p>
                            <p class="text-sm">${enquiry.description}</p>
                        </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('details-modal').classList.remove('hidden');
        }

        function closeDetailsModal() {
            document.getElementById('details-modal').classList.add('hidden');
        }

        // Assignment functions
        function openAssignmentModal(id) {
            document.getElementById('modal-enquiry-id').value = id;
            document.getElementById('assignment-modal').classList.remove('hidden');
        }

        function closeAssignmentModal() {
            document.getElementById('assignment-modal').classList.add('hidden');
            document.getElementById('modal-enquiry-id').value = '';
            document.getElementById('manager-select').value = '';
        }

        function confirmAssignment() {
            const enquiryId = document.getElementById('modal-enquiry-id').value;
            const managerId = document.getElementById('manager-select').value;

            if (!managerId) {
                alert('Please select a manager');
                return;
            }

            const enquiry = allEnquiries.find(e => e.id === enquiryId);
            const manager = managers.find(m => m.id == managerId);

            if (enquiry && manager) {
                enquiry.status = 'assigned';
                enquiry.assigned_to = manager.name;
                enquiry.assigned_area = manager.area;

                fetch(`${API_URL}/api/website-enquiry/${enquiryId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: 'assigned',
                        assigned_to: manager.name,
                        assigned_area: manager.area
                    })
                }).then(response => response.json())
                  .then(result => {
                      if (result.success) {
                          closeAssignmentModal();
                          loadEnquiries();
                          alert(`Assigned to ${manager.name} successfully!`);
                      } else {
                          alert('Error assigning enquiry: ' + result.message);
                      }
                  }).catch(error => {
                      console.error('Error assigning enquiry:', error);
                      alert('Error assigning enquiry. Please try again.');
                  });
            }
        }

        // Event listeners
        document.getElementById('search-input').addEventListener('input', filterEnquiries);
        document.getElementById('status-filter').addEventListener('change', filterEnquiries);
        document.getElementById('city-filter').addEventListener('change', filterEnquiries);

        // Mobile menu functionality
        function toggleMobileMenu() {
            const mobileSidebar = document.querySelector('aside');
            const mobileOverlay = document.getElementById('mobile-overlay');
            
            if (mobileSidebar.classList.contains('hidden')) {
                mobileSidebar.classList.remove('hidden');
                mobileSidebar.classList.add('fixed', 'inset-y-0', 'left-0');
                mobileOverlay.classList.remove('hidden');
            } else {
                mobileSidebar.classList.add('hidden');
                mobileSidebar.classList.remove('fixed', 'inset-y-0', 'left-0');
                mobileOverlay.classList.add('hidden');
            }
        }

        document.getElementById('mobile-menu-open').addEventListener('click', toggleMobileMenu);

        // Initial load
        loadEnquiries();
    </script>
</body>
</html>

