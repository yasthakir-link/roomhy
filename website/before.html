 <!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roomhy - Find Your Student Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Add Font Awesome for Footer Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script>
        // API Configuration - Support both local and production
        // For local development, use: http://localhost:3000 or http://localhost:10
        // For production, use: https://roomhy-backend-wqwo.onrender.com
        const API_URL = (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')
            ? 'http://localhost:5000'
            : 'https://roomhy-backend-wqwo.onrender.com';
        
        console.log('Using API_URL:', API_URL);

        tailwind.config = {
            theme: {
            extend: {
                keyframes: {
                    kenburns: {
                        '0%': { transform: 'scale(1) translate(0, 0)' },
                        '100%': { transform: 'scale(1.1) translate(-2%, 2%)' },
                    },
                    // Keyframes for sliding content
                    'slide-left': {
                        '0%': { transform: 'translateX(0%)' },
                        '100%': { transform: 'translateX(-50%)' },
                    },
                    'slide-right': {
                        '0%': { transform: 'translateX(-50%)' },
                        '100%': { transform: 'translateX(0%)' },
                    },
                    // Keyframes for connecting line animation (reversed for flowing effect)
                    'dash-flow-dotted': {
                        '0%': { 'stroke-dashoffset': '0' },
                        '100%': { 'stroke-dashoffset': '20' }, 
                    },
                     'light-dot-move': {
                        '0%': { offsetDistance: '0%' },
                        '100%': { offsetDistance: '100%' },
                    },
                    // NEW: Keyframes for pulsing step badge
                    'pulse-pop': {
                        '0%': { transform: 'scale(0.9)', boxShadow: '0 0 0 0 rgba(59, 130, 246, 0.4)' },
                        '70%': { transform: 'scale(1.1)', boxShadow: '0 0 0 10px rgba(59, 130, 246, 0)' },
                        '100%': { transform: 'scale(0.9)' },
                    },
                    // NEW: Keyframes for subtle float animation
                    'float-subtle': {
                        '0%': { transform: 'translateY(0px)' },
                        '50%': { transform: 'translateY(-5px)' },
                        '100%': { transform: 'translateY(0px)' },
                    }
                },
                    animation: {
                        kenburns: 'kenburns 30s ease-in-out infinite alternate',
                        // Animations for testimonial sliding
                        'slide-left-infinite': 'slide-left 40s linear infinite',
                        'slide-right-infinite': 'slide-right 40s linear infinite',
                        // Animation for connecting line
                        'dash-flow-dotted': 'dash-flow-dotted 1s linear infinite',
                        'light-dot-move': 'light-dot-move 10s linear infinite',
                        // NEW: Animation for pulsing step badge
                        'pulse-pop': 'pulse-pop 2.5s infinite cubic-bezier(0.25, 0.46, 0.45, 0.94)',
                        // NEW: Subtle float for step cards
                        'float-subtle': 'float-subtle 4s ease-in-out infinite',
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f2f6; 
            color: #1F2937;
        }

        .text-shadow {
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .animate-gradient-flow {
            background-size: 200% auto;
            background-image: linear-gradient(to right, #06b6d4 0%, #3b82f6 50%, #06b6d4 100%);
            animation: gradient-flow 10s ease infinite;
        }

        .light-card {
            background: #FFFFFF;
            border: 1px solid #E5E7EB;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
            transition: box-shadow 0.3s ease, transform 0.3s ease;
        }
        .light-card:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            transform: translateY(-4px);
        }
        
        .glow-button {
            transition: all 0.3s ease;
        }
        .glow-button:hover {
            transform: scale(1.05);
        }
        
        .horizontal-slider::-webkit-scrollbar {
            display: none;
        }
        .horizontal-slider {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        .offering-card-item {
            opacity: 0;
        }

        @keyframes slide-in {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-in {
            animation: slide-in 0.7s ease-out forwards;
        }

        @keyframes card-slide-up {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card-animate {
            animation: card-slide-up 0.6s ease-out forwards;
        }
        .cta-section {
            background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1582693630824-53c825364347?q=80&w=2070&auto:format&fit=crop');
            background-size: cover;
            background-position: center;
        }

        /* ====================================================== */
        /* START: UPDATED CSS for Testimonials */
        /* ====================================================== */
        .testimonial-card {
            /* Increased size for better visual weight */
            width: 95vw; /* Takes up most of viewport width on mobile */
            max-width: 450px; /* Increased max width for desktop/larger screens */
            text-align: left; 
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            
            /* Existing styles */
            background-color: #ffffff;
            border-radius: 12px;
            border: 1px solid #E5E7EB;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 24px;
            margin: 0 16px; 
            height: auto; /* Allow content to dictate height */
            white-space: normal; /* Allow text to wrap inside the card */
        }
        
        .testimonial-carousel {
            display: flex;
            overflow: hidden;
            width: 100%;
            -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
            mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
        }

        .testimonial-track-inner {
          display: flex;
          white-space: nowrap; 
          align-items: stretch;
        }

        .testimonial-track-inner > .testimonial-card {
          flex-shrink: 0;
        }

        @keyframes slide-left {
          0%   { transform: translateX(0%); }
          100% { transform: translateX(-50%); } 
        }

        @keyframes slide-right {
          0%   { transform: translateX(-50%); } 
          100% { transform: translateX(0%); }
        }

        .testimonial-row-1 .testimonial-track-inner {
          animation: slide-right 40s linear infinite;
          will-change: transform;
        }

        .testimonial-row-2 .testimonial-track-inner {
          animation: slide-left 40s linear infinite;
          will-change: transform;
        }

        .testimonial-track-inner:hover {
          animation-play-state: paused;
        }

        @media (prefers-reduced-motion: reduce) {
          .testimonial-row-1 .testimonial-track-inner,
          .testimonial-row-2 .testimonial-track-inner {
            animation: none;
          }
        }
        /* ====================================================== */
        /* END: UPDATED CSS for Testimonials */
        /* ====================================================== */


        /* === Footer Styling (UPDATED TO ORIGINAL DARK STYLE) === */
        .footer {
          font-family: 'Inter', sans-serif;
          color: #e5e7eb; /* Light gray text */
          /* Reverted to original dark gradient background */
          background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
          position: relative;
          overflow: hidden;
        }

        .footer a {
          color: #cbd5e1; /* Lighter links */
          text-decoration: none;
          transition: color 0.2s ease;
        }

        .footer a:hover {
          color: #60a5fa; /* Blue hover color */
        }

        .footer-main {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
          gap: 2rem;
          padding: 3rem 2rem;
          align-items: start;
        }
        
        .footer-logo {
            grid-column: span 1;
        }

        .footer-logo img {
          width: 140px;
          margin-bottom: 0.5rem;
        }

        .footer-logo p {
          color: #9ca3af;
          font-size: 0.9rem;
        }

        .footer-links h4,
        .footer-legal h4,
        .footer-contact h4 {
          font-weight: 700;
          color: #ffffff; /* White heading color */
          margin-bottom: 1rem;
          position: relative;
        }

        /* Added back blue underline for dark footer for contrast */
        .footer-links h4::after,
        .footer-legal h4::after,
        .footer-contact h4::after {
          content: '';
          position: absolute;
          bottom: -0.4rem;
          left: 0;
          width: 40px;
          height: 2px;
          background: #60a5fa;
          border-radius: 2px;
        }


        .footer-links ul,
        .footer-legal ul {
          list-style: none;
          padding: 0;
        }

        .footer-links li,
        .footer-legal li {
          margin-bottom: 0.6rem;
        }

        .footer-contact p {
          color: #d1d5db;
          margin: 0.6rem 0;
          font-size: 0.9rem;
        }

        .footer-contact i {
          color: #60a5fa; /* Light blue icon color */
          margin-right: 0.6rem;
        }

        .footer-social {
          margin-top: 1.5rem;
        }

        .footer-social a {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          background: rgba(255, 255, 255, 0.08); /* Dark background */
          color: #ffffff;
          width: 35px;
          height: 35px;
          border-radius: 9999px;
          margin-right: 0.8rem;
          transition: all 0.3s ease;
        }

        .footer-social a:hover {
          background: #60a5fa;
          color: #0f172a; /* Dark background on hover */
          transform: translateY(-2px);
        }

        .footer-bottom {
          border-top: 1px solid rgba(255, 255, 255, 0.1);
          text-align: center;
          padding: 1rem;
          font-size: 0.85rem;
          color: #9ca3af;
          background: rgba(0, 0, 0, 0.2);
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
          .footer-main {
            grid-template-columns: 1fr;
            text-align: left;
          }
          .footer-logo {
            grid-column: span 1;
            margin-bottom: 1.5rem;
          }
        }
        
        /* END: Footer Styling */
        
        /* FAQ STYLES */
        .faq-item {
            border-bottom: 1px solid #e5e7eb;
        }
        .faq-question {
            cursor: pointer;
            padding: 1.25rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 1.125rem;
            color: #111827;
        }
        .faq-answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, padding 0.4s ease-out;
            padding: 0 0;
            color: #4b5563;
        }
        .faq-answer.active {
            max-height: 500px; /* Sufficiently large value */
            padding-bottom: 1.5rem;
        }
        .chevron {
            transition: transform 0.3s ease;
        }
        .chevron.rotated {
            transform: rotate(180deg);
        }

        /* CONTACT SECTION STYLES (Custom wave background) */
        .connect-section {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .wave-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
            z-index: 10;
            pointer-events: none;
        }

        /* SVG for wave background (light, subtle effect) */
        .wave-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.6;
        }
        
        .contact-content {
            position: relative;
            z-index: 20;
        }
        
        .send-button-gradient {
            background-image: linear-gradient(to right, #8a2be2, #a020f0, #9370db);
        }


        /* Custom CSS for animating the SVG path - UPDATED FOR DOTTED LINE */
        .animated-path {
            /* This is critical for the animation effect */
            stroke-dasharray: 5, 15; /* Shorter dash (dot) and larger gap */
            /* Start dash offset at 0 and move it backward to create flow */
            stroke-dashoffset: 0; 
            fill: none; /* Ensure no fill */
            transition: stroke-dashoffset 2s ease-out; /* Smooth transition for visual effect */
            /* Apply the new dash-flow-dotted animation for continuous movement */
            /* Removed dash-flow-dotted animation here to rely fully on scroll control. 
               It will be re-applied via JS if scroll logic is not active (mobile/resize) */
        }

        /* Temporarily disable the dash-flow animation when drawing via scroll */
        .animated-path.draw-on-scroll {
             animation: none !important;
             /* Ensure dasharray is set correctly for the visual dotted line when drawing starts */
             stroke-dasharray: 5, 15; 
             stroke-dashoffset: 0; /* Will be set by JS */
             stroke: #3b82f6 !important; /* Ensure vibrant blue on desktop */
        }

        .animated-path.flow-infinite {
            animation: dash-flow-dotted 1s linear infinite;
        }
        
        /* NEW: Custom styling for city filter cards */
        .city-filter-container .neon-border {
            border: 2px solid #000000 !important; /* Strong black border */
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.8), 0 0 20px rgba(59, 130, 246, 0.4); /* Neon blue glow effect */
            transition: box-shadow 0.3s ease, transform 0.3s ease;
        }
        
        /* 3D Flip Card Styles */
        .city-flip-card {
            perspective: 1000px;
            width: 100%;
            height: 100%;
        }

        .city-flip-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .city-flip-card.flipped .city-flip-inner {
            transform: rotateY(180deg);
        }

        .city-flip-front, .city-flip-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .city-flip-front {
            background-color: white;
            z-index: 2;
        }

        .city-flip-back {
            background-color: white;
            transform: rotateY(180deg);
            z-index: 1;
        }

        .city-flip-front img, .city-flip-back img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* UNIFIED HOVER/ACTIVE/FOCUS STYLES FOR NEON BORDER */
        .city-filter:hover .neon-border, 
        .city-filter:active .neon-border,
        .city-filter:focus .neon-border {
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.9), 0 0 25px rgba(239, 68, 68, 0.5); /* Hover glow to red/pink for contrast */
        }
        
        /* UNIFIED HOVER/ACTIVE/FOCUS STYLES FOR NEON BORDER - APPLYING TRANSFORM TO THE PARENT CONTAINER */
        .city-filter:hover, 
        .city-filter:active,
        .city-filter:focus {
            transform: translateY(-2px); /* Apply lift effect to the whole container */
            transition: transform 0.3s ease;
        }
        
        /* === UPDATED CITY IMAGE SLIDE/KEN BURNS EFFECT === */
        .city-filter .city-image {
             /* Increased duration for a smoother "slide" feel */
             transition: transform 0.8s ease-in-out;
        }
        /* DESKTOP/FOCUS HOVER EFFECT (This applies the image slide/scale) */
        .city-filter:hover .city-image,
        .city-filter:focus .city-image {
             /* Scale up and translate right/down for a subtle Ken Burns "slide" effect */
             transform: scale(1.2) translate(5%, 5%); 
        }
        /* For touch devices, ensure tapping (active) doesn't keep the animation, only the hover/focus state applies the slide. */
        .city-filter:active .city-image {
             /* When active (tapped), reset the slide transformation to avoid keeping the slide */
             transform: scale(1); /* Ensure it doesn't slide on tap, only on hover/focus */
             transition-duration: 0.1s; /* Quick reset for active state */
        }
        /* ============================================== */
        
        /* NEW: 3D Card and Flow Styles for How It Works */

        .step-card-3d {
            background-color: #ffffff;
            border-radius: 20px;
            padding: 30px;
            /* Stronger lift shadow + Blue ambient glow for 3D feel */
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 
                        0 15px 30px -5px rgba(59, 130, 246, 0.3); 
            /* Subtle 3D perspective applied to the card */
            transform: perspective(1000px) rotateX(0deg) scale(1);
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
            border: 1px solid #e5e7eb;
            /* Add scroll reveal base styles */
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out, box-shadow 0.5s, transform 0.5s;
        }
        
        /* Class applied by Intersection Observer for reveal */
        .step-card-3d.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        .step-card-3d.is-visible .step-badge {
            animation-delay: 0.5s; /* Delay pulse after card slides in */
        }
        
        .step-card-3d:hover {
            /* Subtle 3D tilt on hover for the interactive feel */
            transform: perspective(1000px) rotateX(2deg) scale(1.02); 
            box-shadow: 0 40px 80px -20px rgba(0, 0, 0, 0.35),
                        0 20px 40px -8px rgba(96, 165, 250, 0.5); /* Stronger glow */
        }
        
        /* Step Dot (Connection Circle) Styling */
        .step-dot {
            fill: #ffffff;
            stroke: #3b82f6;
            stroke-width: 4;
        }
        
        /* NEW: Styles for the step number badge to ensure pulsing */
        .step-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 9999px;
            font-weight: 700;
            color: #ffffff;
            background-image: linear-gradient(135deg, #3b82f6, #06b6d4);
            box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); /* Initial shadow for pulse */
        }
        
        /* Mobile divider line styling */
        .mobile-divider {
            position: relative;
            height: 100%;
        }
        .mobile-divider::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 2px;
            background: repeating-linear-gradient(
                to bottom,
                #93c5fd, /* Blue-300 */
                #93c5fd 5px,
                transparent 5px,
                transparent 15px
            );
        }
        /* Continuous subtle float on desktop only (removed hover scale up) */
        @media (min-width: 1024px) {
            .step-card-3d {
                animation: float-subtle 4s ease-in-out infinite;
            }
            #step-2.step-card-3d {
                 /* Offset the timing for visual variety */
                animation-delay: 1.5s; 
            }
            #step-3.step-card-3d {
                animation-delay: 3s;
            }
        }


    </style>
</head>
<body class="text-gray-800">

    <header class="sticky top-0 z-30 w-full bg-white/95 backdrop-blur-sm shadow-sm">
        <div class="container mx-auto px-4 sm:px-6">
            <div class="flex h-20 items-center justify-between">
                
                <div class="flex items-center">
                    <a href="#" class="flex-shrink-0">
                        <!-- Assuming https://res.cloudinary.com/dpwgvcibj/raw/upload/v1768990275/roomhy/website/logo is available -->
                        <img src="https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990260/roomhy/website/logoroomhy.png" alt="Roomhy Logo" class="h-10 w-25">
                    </a>
                </div>
                
                <div class="flex items-center gap-3 sm:gap-6">
                    <nav class="hidden lg:flex items-center space-x-6">
                        <a href="about.html" class="text-gray-600 hover:text-blue-600 font-medium transition-colors">About Us</a>
                        <a href="#faq" class="text-gray-600 hover:text-blue-600 font-medium transition-colors">FAQ</a>
                        <a href="contact.html" class="text-gray-600 hover:text-blue-600 font-medium transition-colors">Contact</a>
                    </nav>

                    <a href="list.html" class="flex-shrink-0 flex items-center justify-center bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 sm:px-4 py-2 rounded-lg text-sm font-semibold transition-colors w-10 h-10 sm:w-auto sm:h-auto sm:px-4">
                        <span class="text-lg font-bold">+</span>
                    </a>
                    
                    <button id="menu-toggle" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i data-lucide="menu" class="w-7 h-7 text-gray-800"></i>
                    </button>
                </div>

            </div>
        </div>
    </header>

    <section class="relative py-20 md:py-28 text-white">
        <div id="hero-image-wrapper" class="absolute inset-0 w-full h-full overflow-hidden">
            
            <img src="https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?q=80&w=1980&auto:format&fit=crop" 
                 alt="Hero background 1" 
                 class="absolute inset-0 w-full h-full object-cover transition-opacity duration-1000 ease-in-out animate-kenburns opacity-100">
            
            <img src="https://images.unsplash.com/photo-1512917774080-9991f1c4c750?q=80&w=2070&auto:format&fit=crop" 
                 alt="Hero background 2" 
                 class="absolute inset-0 w-full h-full object-cover transition-opacity duration-1000 ease-in-out animate-kenburns opacity-0">
            
            <img src="https://images.unsplash.com/photo-1494203484021-3c454daf695d?q=80&w=2070&auto:format&fit=crop" 
                 alt="Hero background 3" 
                 class="absolute inset-0 w-full h-full object-cover transition-opacity duration-1000 ease-in-out animate-kenburns opacity-0">

            <div class="absolute inset-0 w-full h-full bg-black/60"></div> 
        </div>

        <div class="container mx-auto px-4 sm:px-6 text-center relative z-10">
            <h1 class=" text-1l md:text-4xl font-bold text-shadow mb-6 " style="color: #fffcf2;">
                SEARCH.CONNECT.SUCCEED
            </h1>
            <div class="relative w-full max-w-2xl mx-auto">
                <input type="text" id="hero-search-input" placeholder="Search for 'PG near me' or 'Hostel in Kota'" class="w-full p-4 pl-5 pr-14 rounded-lg bg-white text-gray-900 border-transparent focus:ring-4 focus:ring-cyan-300/50 focus:outline-none placeholder-gray-500 shadow-lg">
                <button type="submit" id="hero-search-btn" class="absolute right-2.5 top-1/2 -translate-y-1/2 p-2.5 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">
                    <i data-lucide="search" class="w-5 h-5 text-white"></i>
                </button>
            </div>
        </div>
    </section>

    <div id="menu-overlay" class="fixed inset-0 bg-black/50 z-40 hidden"></div>
    
    <div id="mobile-menu" class="fixed top-0 right-0 w-80 h-full bg-white z-50 shadow-xl transform translate-x-full transition-transform duration-300 ease-in-out flex flex-col">
        <div class="flex justify-end p-4 flex-shrink-0">
            <button id="menu-close" class="p-2">
                <i data-lucide="x" class="w-6 h-6 text-gray-700"></i>
            </button>
        </div>

        <div class="flex justify-between items-center px-6 py-2">
            <div class="flex items-center space-x-3">
                <div class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center">
                    <i data-lucide="users" class="w-6 h-6 text-gray-600"></i>
                </div>
                <span class="text-lg font-semibold text-gray-800">Hi,welcome ðŸ‘‹</span>
            </div>
            <a href="profile.html" class="text-sm font-medium text-blue-600 hover:underline">Profile</a>
        </div>

        <div class="px-6 py-4">
            <div class="border border-blue-200 rounded-lg p-4 relative overflow-hidden">
                <img src="https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990266/roomhy/website/post.png" alt="Illustartion of people with house" class="absolute right-0 bottom-0 opacity-80 w-32 h-auto" style="pointer-events: none;">
                <p class="font-semibold text-gray-800 mb-3 relative z-10">Looking to Sell/Rent your Property?</p>
                <a href="list.html" class="block text-center w-full text-gray-800 font-medium py-2 px-4 rounded-lg text-sm hover:text-blue-600 transition-colors relative z-10 border border-gray-300" style="width: 150px;">
                    +
                </a>
            </div>
        </div>

        <nav class="flex-grow p-4 space-y-1 overflow-y-auto">
            <a href="ourproperty.html" class="flex items-center space-x-4 p-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0">
                    <i data-lucide="home" class="w-5 h-5 text-blue-600"></i>
                </div>
                <span>Our Properties</span>
            </a>
            <a href="fav.html" class="flex items-center space-x-4 p-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                <div class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0">
                    <i data-lucide="heart" class="w-5 h-5 text-red-600"></i>
                </div>
                <span>Favorites</span>
            </a>
            <a href="mystays.html" class="flex items-center space-x-4 p-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0">
                    <i data-lucide="building" class="w-5 h-5 text-purple-600"></i>
                </div>
                <span>My Stays</span>
            </a>
            <a href="about.html" class="flex items-center space-x-4 p-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                <div class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center flex-shrink-0">
                    <i data-lucide="info" class="w-5 h-5 text-yellow-600"></i>
                </div>
                <span>About Us</span>
            </a>
            <a href="contact.html" class="flex items-center space-x-4 p-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                <div class="w-8 h-8 rounded-full bg-cyan-100 flex items-center justify-center flex-shrink-0">
                    <i data-lucide="phone" class="w-5 h-5 text-cyan-600"></i>
                </div>
                <span>Contact Us</span>
            </a>
            <a href="websitechat.html" class="flex items-center space-x-4 p-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                    <i data-lucide="message-circle" class="w-5 h-5 text-green-600"></i>
                </div>
                <span>Chat</span>
            </a>
        </nav>
        
        <div class="p-4 border-t flex-shrink-0">
            <a href="#" class="flex items-center space-x-4 p-3 rounded-lg text-red-600 hover:bg-red-50">
                <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center flex-shrink-0">
                    <i data-lucide="log-out" class="w-5 h-5 text-gray-600"></i>
                </div>
                <span>Logout</span>
            </a>
        </div>
    </div>

    <!-- START: UPDATED TOP CITIES SECTION (Reverted to scrollable list with hover slide effect) -->
    <section id="top-cities-categories" class="container mx-auto px-4 sm:px-6 -mt-8 relative z-10">
        <div class="bg-white py-4 shadow-lg rounded-2xl city-filter-container overflow-hidden"> 
            <h2 class="sr-only">Top Cities</h2>
            
             <!-- Cities list now uses manual horizontal scroll (horizontal-slider) -->
            <div id="cities-category-slider" class="flex gap-4 md:gap-8 pb-2 scroll-smooth px-4 horizontal-slider overflow-x-auto">
                <!-- Dynamic city cards will be inserted here by JavaScript (rebuildCityList) -->
            </div>
            
        </div>
    </section>
    <!-- END: UPDATED TOP CITIES SECTION -->
    <main class="container mx-auto px-4 sm:px-6 py-8 md:py-12 space-y-16">
      <section id="offerings" class="light-card rounded-2xl p-6">

    <h2 class="text-2xl font-bold mb-6 text-gray-900">Our offering</h2>

    <div class="relative -m-2">

        <button id="offer-prev" class="absolute -left-2 top-1/2 -translate-y-1/2 z-10 p-2 bg-white rounded-full shadow-md hover:bg-gray-100 text-gray-700 sm:block"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>

        

        <div id="offerings-slider" class="flex gap-5 overflow-x-auto pb-2 pt-2 -mx-4 px-4 snap-x snap-mandatory scroll-smooth horizontal-slider" style="padding-left:100px;">

            

            <a href="ourproperty.html?type=hostel" class="group block flex-shrink-0 snap-start w-102 md:w-164 lg:w-172 offering-card-item">

                <div class="relative rounded-xl shadow-md hover:shadow-lg overflow-hidden h-40 sm:h-44 cursor-pointer offering-card transition-shadow duration-300">

                    <img src="https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990227/roomhy/website/angels-hostel-taipei-taiwan-9.jpg" class="w-550px h-full object-cover transition-transform duration-500 group-hover:scale-110" alt="Hostel">

                    
                    <!-- Updated hover effect to be more interactive and revealing -->
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent transition-opacity duration-500 group-hover:opacity-0">

                        <div class="absolute bottom-0 left-0 right-0 p-4">

                            <h3 class="text-white text-center text-sm sm:text-base font-bold leading-tight">Hostel</h3>

                        </div>

                    </div>

                    

                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-500">

                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-500">

                            <h3 class="text-white text-center text-sm sm:text-base font-bold leading-tight mb-2">Hostel</h3>

                            <p class="text-white/90 text-center text-xs sm:text-sm leading-relaxed">Affordable shared spaces with all essentials covered.</p>

                        </div>

                    </div>

                    

                    <div class="hidden sm:block absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-all duration-500 transform -translate-y-2 group-hover:translate-y-0">

                         <div class="w-6 h-6 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center">

                            <i data-lucide="chevron-right" class="w-3 h-3 text-white"></i>

                        </div>

                    </div>

                </div>

            </a>

               <a href="ourproperty.html?type=pg" class="group block flex-shrink-0 snap-start w-102 md:w-164 lg:w-172 offering-card-item">

                <div class="relative rounded-xl shadow-md hover:shadow-lg overflow-hidden h-40 sm:h-44 cursor-pointer offering-card transition-shadow duration-300">

                    <img src="https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990226/roomhy/website/401230348.jpg" class="w-550px h-full object-cover transition-transform duration-500 group-hover:scale-110" alt="Hostel">

                       

                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent transition-opacity duration-500 group-hover:opacity-0">

                        <div class="absolute bottom-0 left-0 right-0 p-4">

                             <h3 class="text-white text-center text-sm sm:text-base font-bold leading-tight">PG</h3>

                        </div>

                    </div>

                    

                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-500">

                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-500">

                            <h3 class="text-white text-center text-sm sm:text-base font-bold leading-tight mb-2">PG</h3>

                            <p class="text-white/90 text-center text-xs sm:text-sm leading-relaxed">Comfortable living with meals and best locations.</p>

                        </div>

                    </div>

                    

                    <div class="hidden sm:block absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-all duration-500 transform -translate-y-2 group-hover:translate-y-0">

                         <div class="w-6 h-6 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center">

                            <i data-lucide="chevron-right" class="w-3 h-3 text-white"></i>

                        </div>

                    </div>

                </div>

            </a>

            
            <a href="ourproperty.html?type=apartment" class="group block flex-shrink-0 snap-start w-102 md:w-164 lg:w-172 offering-card-item">

                <div class="relative rounded-xl shadow-md hover:shadow-lg overflow-hidden h-40 sm:h-44 cursor-pointer offering-card transition-shadow duration-300">

                    <img src="https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990226/roomhy/website/401230348.jpg" class="w-550px h-full object-cover transition-transform duration-500 group-hover:scale-110" alt="Hostel">

                       

                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent transition-opacity duration-500 group-hover:opacity-0">

                        <div class="absolute bottom-0 left-0 right-0 p-4">

                             <h3 class="text-white text-center text-sm sm:text-base font-bold leading-tight">Apartment</h3>

                        </div>

                    </div>

                    

                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-500">

                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-500">

                            <h3 class="text-white text-center text-sm sm:text-base font-bold leading-tight mb-2">Apartment</h3>

                            <p class="text-white/90 text-center text-xs sm:text-sm leading-relaxed">Private living spaces with complete independence.</p>

                        </div>

                    </div>

                    

                    <div class="hidden sm:block absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-all duration-500 transform -translate-y-2 group-hover:translate-y-0">

                         <div class="w-6 h-6 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center">

                            <i data-lucide="chevron-right" class="w-3 h-3 text-white"></i>

                        </div>

                    </div>

                </div>

            </a>

            
            <a href="list.html" class="group block flex-shrink-0 snap-start w-full md:w-64 lg:w-72 offering-card-item">

                <div class="relative rounded-xl shadow-md hover:shadow-lg overflow-hidden h-40 sm:h-44 cursor-pointer offering-card transition-shadow duration-300">

                    <img src="https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990266/roomhy/website/post.png" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" alt="List Your Property">

                    

                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent transition-opacity duration-500 group-hover:opacity-0">

                        <div class="absolute bottom-0 left-0 right-0 p-4">

                            <h3 class="text-white text-center text-sm sm:text-base font-bold leading-tight">List Your Property</h3>

                        </div>

                    </div>

                    

                    <div class="absolute inset-0 bg-gradient-to-t from-blue-700/90 via-blue-700/50 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-500">

                        <div class="absolute inset-0 flex flex-col items-center justify-center p-3 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-500">

                            <h3 class="text-white text-center text-sm sm:text-base font-bold leading-tight mb-2">List Your Property</h3>

                            <p class="text-white/90 text-center text-xs sm:text-sm leading-relaxed">Reach thousands of verified tenants instantly.</p>

                        </div>

                    </div>

                    

                    <div class="hidden sm:block absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-all duration-500 transform -translate-y-2 group-hover:translate-y-0">

                         <div class="w-6 h-6 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center">

                            <i data-lucide="chevron-right" class="w-3 h-3 text-white"></i>

                        </div>

                    </div>

                </div>

            </a>

            

        </div>

        <button id="offer-next" class="absolute -right-2 top-1/2 -translate-y-1/2 z-10 p-2 bg-white rounded-full shadow-md hover:bg-gray-100 text-gray-700 sm:block"><i data-lucide="chevron-right" class="w-6 h-6"></i></button>

    </div>

</section>    
<section id="why-roomhy" class="scroll-mt-20 light-card rounded-2xl p-6 md:p-8">
   <div class="lg:grid lg:grid-cols-2 lg:gap-16 lg:items-center">
                 <div class="text-left lg:order-2">
                     <div class="animate-slide-in text-center lg:text-left">
                         <h2 class="text-3xl md:text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-cyan-600">Why Roomhy?</h2>
                     </div>
                      <div class="hidden lg:block animate-slide-in text-left mt-8">
                         <p class="text-gray-600 mb-6 text-lg">Roomhy was built by students, for students. We experienced the chaos of finding a reliable place to live and knew there had to be a better way.</p>
                         <p class="text-gray-600">We're more than a platform; we're your first friend in a new city, dedicated to helping you find a space where you can thrive.</p>
                     </div>
                </div>
                <div class="w-full max-w-3xl mx-auto grid grid-cols-2 grid-rows-2 gap-4 mt-8 lg:mt-0 animate-slide-in lg:order-1" style="animation-delay: 0.2s;">
                    <div class="row-span-2 col-span-1">
                        <img src="https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990242/roomhy/website/hostel1.png.jpg" class="h-full w-full object-cover rounded-2xl shadow-lg" alt="Modern student accommodation building">
                    </div>
                    <div class="col-span-1">
                        <img src="https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990244/roomhy/website/hostel2.jpg" class="h-full w-full object-cover rounded-2xl shadow-lg" alt="Student common room with yellow chairs">
                    </div>
                    <div class="col-span-1">
                         <img src="https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990245/roomhy/website/hostel3.jpg" class="h-full w-full object-cover rounded-2xl shadow-lg" alt="Bright and modern student room hallway">
                    </div>
                </div>
                <div class="lg:hidden animate-slide-in text-left mt-8">
                    <p class="text-gray-600 mb-6 text-lg">Roomhy was built by students, for students. We experienced the chaos of finding a reliable place to live and knew there had to be a better way.</p>
                    <p class="text-gray-600">We're more than a platform; we're your first friend in a new city, dedicated to helping you find a space where you can thrive.</p>
                </div>
            </div>
        </section>

        <section id="top-spaces" class="light-card rounded-2xl p-6">
            <h2 id="top-spaces-title" class="text-2xl md:text-3xl font-bold mb-6 text-gray-900">Top Spaces in Indore</h2>
            <div class="relative -m-2"> <button id="spaces-prev" class="hidden -left-2 top-1/2 -translate-y-1/2 z-10 p-2 bg-white rounded-full shadow-md hover:bg-gray-100 text-gray-700 sm:block lg:hidden"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>
                
                <div id="spaces-slider" class="flex gap-6 overflow-x-auto pb-2 pt-2 -mx-4 px-4 snap-x snap-mandatory scroll-smooth horizontal-slider lg:grid lg:grid-cols-4 lg:gap-6 lg:overflow-visible lg:p-0 lg:m-0">
                    <!-- Dynamic content generated by JavaScript: updateTopSpaces('Indore') -->
                    </div>
                
                <button id="spaces-next" class="hidden absolute -right-2 top-1/2 -translate-y-1/2 z-10 p-2 bg-white rounded-full shadow-md hover:bg-gray-100 text-gray-700 sm:block lg:hidden"><i data-lucide="chevron-right" class="w-6 h-6"></i></button>
            </div>
        </section>
        
        <!-- START: OVERHAULED HOW IT WORKS SECTION (3D Cards and Enhanced Animation) -->
        <section id="how-it-works" class="relative overflow-hidden py-16 md:py-24 bg-gray-50">
            <div class="container mx-auto px-4 sm:px-6">
                <div class="text-center">
                    <h2 class="text-3xl md:text-5xl font-extrabold mb-4 text-gray-900 leading-tight">
                        <span class="bg-clip-text text-transparent animate-gradient-flow" style="background-image: linear-gradient(to right, #06b6d4, #3b82f6, #06b6d4);">Find Your Home, Simply.</span>
                    </h2>
                    <p class="text-xl text-gray-500 max-w-2xl mx-auto mb-20 lg:mb-32">Roomhy's 3-step process ensures you get the best space, price, and experience.</p>
                </div>
    
                <!-- Connecting lines for desktop (VIBRANT BLUE, animated) -->
                <!-- SVG viewBox adjusted slightly to connect card centers -->
                <div class="hidden lg:block absolute top-0 left-0 w-full h-full -z-10">
                    <svg width="100%" height="100%" viewBox="0 0 1200 850" preserveAspectRatio="none">
                        
                        <!-- Line 1: Connects Step 1 (Center-Right) to Step 2 (Center-Left) -->
                        <path id="path1" d="M 450 250 C 600 250, 600 500, 750 500" 
                              stroke="#3b82f6" stroke-width="4" fill="none" 
                              class="animated-path flow-infinite"/>
                        
                        <!-- Line 2: Connects Step 2 (Center-Right) to Step 3 (Center-Left) -->
                        <path id="path2" d="M 750 500 C 600 500, 600 750, 450 750" 
                              stroke="#3b82f6" stroke-width="4" fill="none" 
                              class="animated-path flow-infinite"/>

                        <!-- Dots/Circles (Fixed points) - Increased size and changed class -->
                        <circle cx="450" cy="250" r="10" class="step-dot"/>
                        <circle cx="750" cy="500" r="10" class="step-dot"/>
                        <circle cx="450" cy="750" r="10" class="step-dot"/>
                    </svg>
                </div>
                
                <div class="space-y-24 lg:space-y-36 relative">
                    
                    <!-- Step 1: Search & Discover (Desktop text is on the right, image is on the left) -->
                    <div id="step-1" class="step-card-3d grid lg:grid-cols-2 gap-8 items-center relative" data-step-id="1">
                        
                        <!-- Mobile divider and Step Badge -->
                        <div class="lg:hidden absolute top-full left-1/2 w-px h-24 -translate-x-1/2 mobile-divider"></div>
                        <div class="lg:hidden absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 step-badge animate-pulse-pop">1</div>
                        
                         <div class="w-full max-w-lg mx-auto lg:mx-0">
                             <!-- Image Block 1 -->
                             <div class="grid grid-cols-2 grid-rows-2 gap-4">
                                <div class="row-span-2 col-span-1">
                                    <img src="https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990247/roomhy/website/hostel4.jpg" class="h-full w-full object-cover rounded-xl shadow-md" alt="Students searching on laptop">
                                </div>
                                <div class="col-span-1">
                                    <img src="https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990248/roomhy/website/hostel5.jpg" class="h-full w-full object-cover rounded-xl shadow-md" alt="Modern interior">
                                </div>
                                <div class="col-span-1">
                                     <img src="https://images.unsplash.com/photo-1554995207-c18c203602cb?q=80&w=2070&auto:format&fit=crop" class="h-full w-full object-cover rounded-xl shadow-md" alt="Bright living room">
                                </div>
                            </div>
                        </div>
                         <div class="text-center lg:text-left relative">
                            <!-- Desktop Step Badge -->
                            <div class="hidden lg:flex absolute -left-16 top-1/2 -translate-y-1/2 step-badge animate-pulse-pop">1</div>
                            <span class="hidden lg:inline text-sm font-bold text-blue-600 bg-blue-100 px-3 py-1 rounded-full">Your Journey Starts Here</span>
                            <h3 class="text-3xl font-bold my-4 text-gray-900 leading-snug">Search, Filter & Shortlist</h3> 
                            <p class="text-gray-600 text-lg leading-relaxed">Use our smart, student-focused filters to find verified PGs, hostels, or apartments near your college campus. **Compare transparent prices, 360Â° virtual tours, and essential amenities.**</p>
                        </div>
                    </div>
    
                    <!-- Step 2: Book Instantly (Desktop text is on the left, image is on the right) -->
                    <div id="step-2" class="step-card-3d grid lg:grid-cols-2 gap-8 items-center relative" data-step-id="2">
                         
                        <!-- Mobile divider and Step Badge -->
                        <div class="lg:hidden absolute top-full left-1/2 w-px h-24 -translate-x-1/2 mobile-divider"></div>
                        <div class="lg:hidden absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 step-badge animate-pulse-pop">2</div>
                        
                        <div class="w-full max-w-lg mx-auto lg:mx-0 lg:order-2">
                            <!-- Image Block 2 -->
                            <div class="grid grid-cols-2 gap-4">
                                <img src="https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990227/roomhy/website/angels-hostel-taipei-taiwan-9.jpg" alt="Online booking confirmation" class="rounded-xl shadow-md w-full h-full object-cover col-span-2">
                                <img src="https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990226/roomhy/website/401230348.jpg" alt="Student smiling" class="rounded-xl shadow-md w-full h-full object-cover">
                                <img src="https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990250/roomhy/website/hostel7.jpg" alt="Close up of online payment" class="rounded-xl shadow-md w-full h-full object-cover">
                            </div>
                        </div>
                         <div class="lg:order-1 text-center lg:text-left relative">
                            <!-- Desktop Step Badge -->
                            <div class="hidden lg:flex absolute -right-16 top-1/2 -translate-y-1/2 step-badge animate-pulse-pop">2</div>
                            <span class="hidden lg:inline text-sm font-bold text-blue-600 bg-blue-100 px-3 py-1 rounded-full">Secure Your Deal</span>
                            <h3 class="text-3xl font-bold my-4 text-gray-900 leading-snug">Place a Bid & Book</h3> 
                            <p class="text-gray-600 text-lg leading-relaxed">Found the ideal place? **Use our unique bidding system to propose your rental price, or book instantly!** Pay a small, secure token amount to lock in your room online, hassle-free.</p>
                        </div>
                    </div>
    
                    <!-- Step 3: Move In (Desktop text is on the right, image is on the left) -->
                    <div id="step-3" class="step-card-3d grid lg:grid-cols-2 gap-8 items-center relative" data-step-id="3">
                         
                         <!-- Mobile Step Badge -->
                         <div class="lg:hidden absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 step-badge animate-pulse-pop">3</div>
                         
                         <div class="w-full max-w-lg mx-auto lg:mx-0">
                            <!-- Image Block 3 -->
                            <img src="https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990252/roomhy/website/hostel8.jpg" alt="Student moving into a new room" class="rounded-xl shadow-md w-full h-auto object-cover">
                        </div>
                         <div class="text-center lg:text-left relative lg:order-1">
                            <!-- Desktop Step Badge -->
                            <div class="hidden lg:flex absolute -left-16 top-1/2 -translate-y-1/2 step-badge animate-pulse-pop">3</div>
                            <span class="hidden lg:inline text-sm font-bold text-blue-600 bg-blue-100 px-3 py-1 rounded-full">Welcome Home!</span>
                            <h3 class="text-3xl font-bold my-4 text-gray-900 leading-snug">Finalize & Move In</h3>
                            <p class="text-gray-600 text-lg leading-relaxed">Complete the necessary paperwork directly with the verified owner. Pack your bags, and you're all set! **Welcome to your new, perfectly matched student home.**</p> 
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- END: OVERHAULED HOW IT WORKS SECTION -->



        <section id="top-spaces-kota" class="light-card rounded-2xl p-6">
            <h2 id="top-spaces-title-kota" class="text-2xl md:text-3xl font-bold mb-6 text-gray-900">Top Spaces in Kota</h2>
            <div class="relative -m-2"> <button id="spaces-prev-kota" class="hidden absolute -left-2 top-1/2 -translate-y-1/2 z-10 p-2 bg-white rounded-full shadow-md hover:bg-gray-100 text-gray-700 sm:block lg:hidden"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>
                
                <div id="spaces-slider-kota" class=" flex gap-6 overflow-x-auto pb-2 pt-2 -mx-4 px-4 snap-x snap-mandatory scroll-smooth horizontal-slider lg:grid lg:grid-cols-4 lg:gap-6 lg:overflow-visible lg:p-0 lg:m-0">
                    <!-- Dynamic content generated by JavaScript: updateTopSpacesKota('Kota') -->
                    </div>
                
                <button id="spaces-next-kota" class="hidden absolute -right-2 top-1/2 -translate-y-1/2 z-10 p-2 bg-white rounded-full shadow-md hover:bg-gray-100 text-gray-700 sm:block lg:hidden"><i data-lucide="chevron-right" class="w-6 h-6"></i></button>
            </div>
        </section>
        <section id="why-choose-us">
            <div class="text-center"><h2 class="text-3xl md:text-4xl font-bold mb-12 text-gray-900">Why Students Choose Us</h2></div>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="light-card p-6 rounded-xl flex items-start space-x-4"><div class="bg-gradient-to-br from-green-500 to-emerald-600 text-white w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0 shadow-lg shadow-green-500/30"><i data-lucide="wallet" class="w-6 h-6"></i></div><div><h3 class="text-lg font-semibold text-gray-900">Zero Brokerage</h3><p class="text-gray-500 mt-1">Save your money for what matters. We connect you directly with property owners, with no hidden fees.</p></div></div>
                <div class="light-card p-6 rounded-xl flex items-start space-x-4"><div class="bg-gradient-to-br from-orange-500 to-amber-600 text-white w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0 shadow-lg shadow-orange-500/30"><i data-lucide="sofa" class="w-6 h-6"></i></div><div><h3 class="text-lg font-semibold text-gray-900">Fully Furnished</h3><p class="text-gray-500 mt-1">Move in with just your suitcase. Our properties come with all the essential furniture and amenities.</p></div></div>
                <div class="light-card p-6 rounded-xl flex items-start space-x-4"><div class="bg-gradient-to-br from-blue-500 to-cyan-600 text-white w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0 shadow-lg shadow-blue-500/30"><i data-lucide="heart-handshake" class="w-6 h-6"></i></div><div><h3 class="text-lg font-semibold text-gray-900">24/7 Support</h3><p class="text-gray-500 mt-1">From booking to move-out, our dedicated support team is always here to help you.</p></div></div>
            </div>
        </section>
        <section id="guarantee">
            <div class="light-card rounded-2xl p-8 grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
                <div><h3 class="text-3xl md:text-4xl font-bold text-cyan-600">50K+</h3><p class="text-gray-500 mt-2">Happy Students</p></div>
                <div><h3 class="text-3xl md:text-4xl font-bold text-blue-600">10K+</h3><p class="text-gray-500 mt-2">Verified Properties</p></div>
                <div><h3 class="text-3xl md:text-4xl font-bold text-sky-600">200+</h3><p class="text-gray-500 mt-2">Cities Served</p></div>
                <div><h3 class="text-3xl md:text-4xl font-bold text-teal-600">100%</h3><p class="text-gray-500 mt-2">Brokerage Free</p></div>
            </div>
        </section>
        
        <section id="rent-smarter" class="light-card rounded-2xl p-6 md:p-8 overflow-hidden">
            <div class="grid lg:grid-cols-2 gap-12 lg:gap-16 items-center">
                
                <div class="animate-slide-in">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">Rent Smarter. Live Better. <br class="hidden lg:block"> <span class="text-blue-600">With Roomhy</span></h2>
                    
                    <div class="space-y-8 mt-10">
                        
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 bg-blue-100 text-blue-600 p-3 rounded-lg shadow-sm">
                                <i data-lucide="badge-percent" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold text-gray-900 mb-1">Zero Brokerage Always</h3>
                                <p class="text-gray-500 leading-relaxed">Tired of paying brokers just to see a room? With Roomhy, you connect directly with verified property owners. No middlemen, no extra charges "ï¿½ just a clean, commission-free experience.</p>
                            </div>
                        </div>

                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 bg-green-100 text-green-600 p-3 rounded-lg shadow-sm">
                                <i data-lucide="gavel" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold text-gray-900 mb-1">Only Pay What You Bid</h3>
                                <p class="text-gray-500 leading-relaxed">No fixed pricing. No pressure. Set your own budget and place a live bid "ï¿½ the owner picks the best offer. It's fast, fair, and puts you in control from the start.</p>
                            </div>
                        </div>

                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 bg-purple-100 text-purple-600 p-3 rounded-lg shadow-sm">
                                <i data-lucide="user-check" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold text-gray-900 mb-1">Rooms That Match Your Vibe & Budget</h3>
                                <p class="text-gray-500 leading-relaxed">Whether you want a solo PG, a shared space with friends, or a budget hostel near college "ï¿½ Roomhy has it all. Search by location, amenities, and real-time availability to find your perfect stay.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="animate-slide-in" style="animation-delay: 0.2s;">
                    <img src="https://images.unsplash.com/photo-1523240795612-9a054b0db644?q=80&w=2070&auto:format&fit=crop" 
                         alt="Happy students" 
                         class="w-full h-full object-cover rounded-2xl shadow-lg"
                         style="max-height: 500px;">
                </div>
                
            </div>
        </section>
        <section id="register-property" class="cta-section rounded-2xl text-white p-12 text-center flex flex-col items-center">
            <h2 class="text-3xl md:text-4xl font-bold mb-4">Have a Property to Rent Out?</h2>
            <p class="text-lg text-gray-200 max-w-2xl mx-auto mb-8">Join our network of trusted property owners and reach thousands of students looking for a home. Listing is free and easy!</p>
            <a href="signuprole.html" class="glow-button text-white px-8 py-3 rounded-lg font-semibold text-lg" style="background: linear-gradient(90deg, #06b6d4, #3b82f6); box-shadow: 0 4px 14px 0 rgba(59, 130, 246, 0.39);">Register Now</a>
        </section>

        <!-- START: UPDATED TESTIMONIALS SECTION -->
        <section id="testimonials" class="overflow-hidden py-12">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold mb-4 text-gray-900">Trusted by 10,000+ Students</h2>
            </div>
            
            <div class="testimonial-carousel testimonial-row-1 mb-8">
                <div class="testimonial-track">
                    <div class="testimonial-track-inner" id="testimonial-track-1">
                        <!-- Content generated by JavaScript: buildTestimonialRow -->
                        </div>
                </div>
            </div>

            <div class="testimonial-carousel testimonial-row-2">
                <div class="testimonial-track">
                    <div class="testimonial-track-inner" id="testimonial-track-2">
                         <!-- Content generated by JavaScript: buildTestimonialRow -->
                        </div>
                </div>
            </div>
        </section>
        <!-- END: UPDATED TESTIMONIALS SECTION -->
        
        <!-- START: FAQ SECTION (New Section) -->
        <section id="faq" class="scroll-mt-20 py-12">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid lg:grid-cols-12 gap-10">
                    <div class="lg:col-span-4">
                        <h2 class="text-3xl font-bold text-gray-900 mb-4 lg:sticky lg:top-24">
                            Frequently Asked Questions?
                        </h2>
                        <p class="text-lg text-gray-500 hidden lg:block">Everything you need to know about finding your perfect home with Roomhy.</p>
                    </div>
                    
                    <div class="lg:col-span-8 space-y-2">
                        <!-- FAQ 1 -->
                        <div class="faq-item">
                            <div class="faq-question">
                                <span>What is Roomhy and how does it work?</span>
                                <i data-lucide="chevron-down" class="chevron w-6 h-6"></i>
                            </div>
                            <div class="faq-answer">
                                <p>Roomhy is a student accommodation platform that connects students directly with verified property owners. You search, shortlist, and book properties like PG, hostels, and apartments without paying any brokerage fees. Our bidding feature also allows you to secure the best possible rental price.</p>
                            </div>
                        </div>
                         <!-- FAQ 2 -->
                        <div class="faq-item">
                            <div class="faq-question">
                                <span>Is Roomhy completely broker-free?</span>
                                <i data-lucide="chevron-down" class="chevron w-6 h-6"></i>
                            </div>
                            <div class="faq-answer">
                                <p>Yes, absolutely. Our core promise is zero brokerage. We eliminate the middleman, ensuring you only pay the rent and a small, refundable security deposit directly to the property owner. This saves students thousands in commission fees.</p>
                            </div>
                        </div>
                         <!-- FAQ 3 -->
                        <div class="faq-item">
                            <div class="faq-question">
                                <span>How do I place a bid on a property?</span>
                                <i data-lucide="chevron-down" class="chevron w-6 h-6"></i>
                            </div>
                            <div class="faq-answer">
                                <p>When viewing a property, you can see the owner's expected price. You can then submit a 'bid' or offer that you are willing to pay. The owner can accept, reject, or counter your offer. This live bidding process helps you secure a better deal than fixed-price listings.</p>
                            </div>
                        </div>
                         <!-- FAQ 4 -->
                        <div class="faq-item">
                            <div class="faq-question">
                                <span>What types of properties are listed on Roomhy?</span>
                                <i data-lucide="chevron-down" class="chevron w-6 h-6"></i>
                            </div>
                            <div class="faq-answer">
                                <p>We offer a wide range of properties tailored for students, including: fully furnished Hostels (shared rooms, budget-friendly), PGs (Paying Guest accommodation with meals and services), and Apartments (private flats for independent living or sharing with friends).</p>
                            </div>
                        </div>
                         <!-- FAQ 5 -->
                        <div class="faq-item">
                            <div class="faq-question">
                                <span>Can I view room availability in real-time?</span>
                                <i data-lucide="chevron-down" class="chevron w-6 h-6"></i>
                            </div>
                            <div class="faq-answer">
                                <p>Yes, property owners are encouraged to keep their listings updated in real-time. You can filter properties based on immediate availability and expected move-in dates to ensure you only view options that suit your schedule.</p>
                            </div>
                        </div>
                         <!-- FAQ 6 -->
                        <div class="faq-item">
                            <div class="faq-question">
                                <span>Do I have to pay to use Roomhy as a student?</span>
                                <i data-lucide="chevron-down" class="chevron w-6 h-6"></i>
                            </div>
                            <div class="faq-answer">
                                <p>Searching, browsing, and contacting property owners through Roomhy is entirely free for students. Our revenue comes from value-added services offered to property owners, keeping the platform free and zero-brokerage for tenants.</p>
                            </div>
                        </div>
                         <!-- FAQ 7 -->
                        <div class="faq-item">
                            <div class="faq-question">
                                <span>How is Roomhy different from regular rental websites?</span>
                                <i data-lucide="chevron-down" class="chevron w-6 h-6"></i>
                            </div>
                            <div class="faq-answer">
                                <p>We are focused purely on student needs, ensuring all properties are near major educational hubs. We offer a unique bidding system, guarantee zero brokerage, and verify every listing to save you time and money compared to traditional, generalized rental sites.</p>
                            </div>
                        </div>
                         <!-- FAQ 8 -->
                        <div class="faq-item">
                            <div class="faq-question">
                                <span>Is it safe to book a property on Roomhy?</span>
                                <i data-lucide="chevron-down" class="chevron w-6 h-6"></i>
                            </div>
                            <div class="faq-answer">
                                <p>We prioritize your safety. Every property owner and listing is thoroughly verified by our team. The booking process is secure, and you only finalize the full payment after confirming the property details with the owner.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- END: FAQ SECTION -->

        <!-- START: CONNECT WITH ROOMHY SECTION (Replacing old contact section) -->
        <section id="contact-us" class="scroll-mt-20 py-12">
            <div class="container mx-auto px-4 sm:px-6">
                <div class="connect-section max-w-5xl mx-auto rounded-3xl shadow-2xl relative grid lg:grid-cols-2">
                    
                    <!-- Left Side: Text and Wave Background -->
                    <div class="relative p-10 md:p-16 flex flex-col justify-center">
                        <div class="wave-bg">
                            <!-- SVG Wave for background effect (very light and subtle) -->
                            <svg class="wave-svg" viewBox="0 0 500 500" preserveAspectRatio="none">
                                <path d="M0,200 C150,350 350,50 500,200 L500,0 L0,0 Z" style="fill: #f5f5f5;"></path>
                                <path d="M0,250 C120,400 380,100 500,250 L500,0 L0,0 Z" style="fill: #eeeeee; opacity: 0.5;"></path>
                            </svg>
                        </div>
                        <div class="contact-content text-center lg:text-left">
                            <h2 class="text-3xl md:text-4xl font-extrabold text-gray-900 mb-4 leading-tight">
                                Connect with Roomhy
                            </h2>
                            <p class="text-lg text-gray-600 max-w-sm mx-auto lg:mx-0">
                                Drop your concern, query or feedback and we will get back to you in no time.
                            </p>
                        </div>
                    </div>

                    <!-- Right Side: Form -->
                    <div class="p-8 md:p-16 bg-white contact-content rounded-r-3xl">
                        <form class="space-y-6">
                            
                            <!-- Name -->
                            <div>
                                <label for="contact-name" class="block text-sm font-semibold text-gray-700 mb-2">Name</label>
                                <input type="text" id="contact-name" name="name" class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500" placeholder="Name">
                            </div>
                            
                            <!-- Contact Number -->
                            <div>
                                <label for="contact-phone" class="block text-sm font-semibold text-gray-700 mb-2">Contact Number</label>
                                <input type="tel" id="contact-phone" name="phone" class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500" placeholder="Phone Number">
                            </div>
                            
                            <!-- Query/Concern -->
                            <div>
                                <label for="contact-query" class="block text-sm font-semibold text-gray-700 mb-2">Query</label>
                                <textarea id="contact-query" name="query" rows="4" class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500 resize-none" placeholder="Query/Concern"></textarea>
                            </div>
                            
                            <!-- Submit Button -->
                            <div class="pt-4">
                                <button type="submit" class="w-full text-white font-bold py-3 rounded-lg text-lg transition-all duration-300 send-button-gradient hover:opacity-90 shadow-lg hover:shadow-xl">
                                    Send message
                                </button>
                            </div>

                            <p class="text-center text-xs text-gray-500 pt-2">
                                ** You'd hear from us in the next 24 hours, but if you don't, reach out at 
                                <a href="mailto:hello@roomhy.com" class="text-purple-600 font-medium hover:underline">hello@roomhy.com</a>
                            </p>
                        </form>
                    </div>

                </div>
            </div>
        </section>
        <!-- END: CONNECT WITH ROOMHY SECTION -->

    </main>

    <!-- Website Chat Floating Button and Modal -->
    <button id="websiteChatBtn" class="fixed bottom-6 right-6 z-50 bg-green-500 hover:bg-green-600 text-white p-4 rounded-full shadow-lg transition-transform hover:scale-110" aria-label="Open chat">
        <i data-lucide="message-circle" class="w-8 h-8"></i>
    </button>
    <div id="websiteChatModal" class="fixed bottom-24 right-6 z-50 w-80 bg-white rounded-lg shadow-xl border border-gray-200 hidden flex-col">
        <div class="flex items-center justify-between px-4 py-2 border-b">
            <span class="font-bold text-gray-700">Chat with Owner</span>
            <button id="closeWebsiteChat" class="text-gray-400 hover:text-gray-700" title="Close chat"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div id="websiteChatMessages" class="flex-1 p-3 overflow-y-auto max-h-64 text-sm"></div>
        <div class="flex items-center border-t p-2">
            <input id="websiteChatInput" type="text" class="flex-1 border rounded px-2 py-1 mr-2" placeholder="Type a message...">
            <button id="websiteChatSend" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded">Send</button>
        </div>
    </div>
    
    <!-- Signup Prompt Modal (triggered when unauthenticated user clicks a city) -->
    <div id="signupPromptModal" class="fixed inset-0 z-50 bg-black bg-opacity-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-sm w-full mx-4 p-6">
            <!-- Close Button -->
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold text-gray-900">Sign Up to Continue</h2>
                <button onclick="closeSignupModal()" class="text-gray-400 hover:text-gray-700">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <!-- Message -->
            <p class="text-gray-600 mb-6">
                Sign up with Roomhy to explore <strong id="selectedCityName"></strong> and find your perfect accommodation.
            </p>
            
            <!-- Benefits List -->
            <div class="space-y-3 mb-6">
                <div class="flex items-start space-x-3">
                    <i data-lucide="check-circle" class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"></i>
                    <span class="text-sm text-gray-700">Browse properties in your preferred city</span>
                </div>
                <div class="flex items-start space-x-3">
                    <i data-lucide="check-circle" class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"></i>
                    <span class="text-sm text-gray-700">Send booking requests to property owners</span>
                </div>
                <div class="flex items-start space-x-3">
                    <i data-lucide="check-circle" class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"></i>
                    <span class="text-sm text-gray-700">Chat directly with owners</span>
                </div>
                <div class="flex items-start space-x-3">
                    <i data-lucide="check-circle" class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"></i>
                    <span class="text-sm text-gray-700">Zero brokerage on all bookings</span>
                </div>
            </div>
            
            <!-- Signup Button -->
            <button id="signupRedirectBtn" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white font-semibold py-3 rounded-lg hover:shadow-lg transition-shadow mb-3">
                Create Account Now
            </button>
            
            <!-- Already have account link -->
            <p class="text-center text-gray-600 text-sm">
                Already have an account? <a href="login.html" class="text-purple-600 hover:text-purple-700 font-semibold">Sign In</a>
            </p>
        </div>
    </div>
    
    <!-- START: UPDATED FOOTER -->
    <footer class="footer container mx-auto px-4 sm:px-6 mt-16">
        <div class="footer-main">
            <!-- Logo & Description -->
            <div class="footer-logo">
                <!-- Changed logo placeholder to white text for dark background -->
                <img src="https://placehold.co/180x40/0f172a/ffffff?text=Roomhy+Logo" alt="Roomhy Logo">
                <p class="mt-4">Discover Your Next Home, Together. Zero Brokerage, Student-First Approach.</p>
            </div>

            <!-- Quick Links -->
            <div class="footer-links">
                <h4>Company</h4>
                <ul>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="#featured">Featured Stays</a></li>
                    <li><a href="#faq">FAQ</a></li>
                    <li><a href="contact.html">Contact Us</a></li>
                </ul>
            </div>

            <!-- Locations (Updated to Kota, Sikkar, Indore) -->
            <div class="footer-links">
                <h4>Top Cities</h4>
                <ul>
                    <li><a href="ourproperty.html?city=kota">Kota</a></li>
                    <li><a href="ourproperty.html?city=sikar">Sikar</a></li>
                    <li><a href="ourproperty.html?city=indore">Indore</a></li>
                </ul>
            </div>

            <!-- Legal & Contact -->
            <div class="footer-contact">
                <h4>Support & Legal</h4>
                <div class="space-y-2">
                    <p><i class="fas fa-phone"></i> +91 99830 05030</p>
                    <p><i class="fas fa-envelope"></i> hello@roomhy.com</p>
                </div>
                <ul class="mt-4 space-y-1 text-sm">
                    <li><a href="terms.html">Terms & Conditions</a></li>
                    <li><a href="privacy.html">Privacy Policy</a></li>
                </ul>
            </div>
            
            <!-- Social -->
            <div class="footer-social lg:col-span-1">
                <a href="#" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                <a href="#" title="X"><i class="fab fa-x-twitter"></i></a>
                <a href="#" title="Instagram"><i class="fab fa-instagram"></i></a>
                <a href="#" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
            </div>
        </div>

        <div class="footer-bottom">
            <p>ï¿½ 2025 <strong>Roomhy</strong>. All Rights Reserved. Made for students, with love.</p>
        </div>
    </footer>
    <!-- END: UPDATED FOOTER -->

</body>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            lucide.createIcons();
        });
        lucide.createIcons();
        
        // ======================================================
        // START: CITY CLICK HANDLER WITH AUTH CHECK
        // ======================================================
        function handleCityClick(cityName) {
            // Check if user is logged in (check for valid token or user object)
            const token = localStorage.getItem('token') || sessionStorage.getItem('token');
            const userObj = localStorage.getItem('user') || sessionStorage.getItem('user');
            const isLoggedIn = !!(token || (userObj && userObj !== 'undefined' && userObj.length > 0));
            
            console.log('City clicked:', cityName);
            console.log('Token:', token);
            console.log('UserObj:', userObj);
            console.log('Is Logged In:', isLoggedIn);
            
            if (isLoggedIn) {
                // User is logged in, redirect to property page
                window.location.href = 'ourproperty.html?city=' + encodeURIComponent(cityName);
            } else {
                // User is not logged in, show signup modal
                showSignupModal(cityName);
            }
        }
        
        function showSignupModal(cityName) {
            const modal = document.getElementById('signupPromptModal');
            const cityNameSpan = document.getElementById('selectedCityName');
            const redirectBtn = document.getElementById('signupRedirectBtn');
            
            if (modal && cityNameSpan) {
                cityNameSpan.textContent = cityName;
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                
                // Update button click handler
                redirectBtn.onclick = function() {
                    window.location.href = 'signup.html';
                };
            }
        }
        
        function closeSignupModal() {
            const modal = document.getElementById('signupPromptModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
        }
        // ======================================================
        // END: CITY CLICK HANDLER WITH AUTH CHECK
        // ======================================================
        
        // ======================================================
        // START: JAVASCRIPT CITY DATA (Dynamically loads from MongoDB)
        // Fetches approved properties and extracts unique cities
        // ======================================================
        (function(){
            var defaultCities = [
                { name: "Kota", img: "https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990262/roomhy/website/OIP.jpg", icon: "university" },
                { name: "Sikar", img: "https://images.unsplash.com/photo-1549487560-671520624a9e?q=80&w=2070&auto:format&fit=crop", icon: "building-2" },
                { name: "Indore", img: "https://images.unsplash.com/photo-1570129477492-45c003edd2be?q=80&w=2070&auto:format&fit=crop", icon: "landmark" }
            ];

            // Initialize with defaults immediately
            window.cityInfo = defaultCities;

            // Fetch cities from MongoDB database
            async function loadCitiesFromProperties() {
                try {
                    // Get API base URL - support both local and production
                    const apiBase = (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')
                        ? 'http://localhost:5000'
                        : 'https://roomhy-backend.onrender.com';
                    
                    const response = await fetch(`${apiBase}/api/locations/cities`);
                    if (!response.ok) throw new Error('Failed to fetch cities from MongoDB');
                    
                    const data = await response.json();
                    let cities = (data.data || []).map(city => {
                        // Support both old format (id, image) and new format (_id, imageUrl)
                        return {
                            _id: city._id || city.id,
                            name: city.name || city.cityName,
                            img: city.imageUrl || city.image || 'https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?q=80&w=2070&auto:format&fit=crop',
                            icon: city.icon || 'map-pin'
                        };
                    });
                    
                    if (cities.length > 0) {
                        window.cityInfo = cities;
                        if (typeof rebuildCityList === 'function') {
                            rebuildCityList(window.cityInfo);
                        }
                    } else {
                        window.cityInfo = defaultCities;
                    }
                } catch (error) {
                    console.log('Could not fetch from MongoDB, using default cities:', error.message);
                    // Fallback: Try to fetch from approved properties
                    try {
                        const response = await fetch(`${apiBase}/api/website-enquiry/all`);
                        if (!response.ok) throw new Error('Failed to fetch properties');
                        
                        const data = await response.json();
                        let properties = (data.enquiries || []).filter(p => p.status === 'completed');
                        
                        // Extract unique cities from approved properties
                        const citiesMap = new Map();
                        properties.forEach(prop => {
                            const city = prop.city;
                            if (city && !citiesMap.has(city)) {
                                // Try to find a matching default city for consistent images/icons
                                const defaultCity = defaultCities.find(c => c.name.toLowerCase() === city.toLowerCase());
                                citiesMap.set(city, defaultCity || {
                                    name: city,
                                    img: 'https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?q=80&w=2070&auto:format&fit=crop',
                                    icon: 'map-pin'
                                });
                            }
                        });
                        
                        const cities = Array.from(citiesMap.values());
                        if (cities.length > 0) {
                            window.cityInfo = cities;
                            if (typeof rebuildCityList === 'function') {
                                rebuildCityList(window.cityInfo);
                            }
                        } else {
                            window.cityInfo = defaultCities;
                        }
                    } catch (fallbackError) {
                        console.log('Using default cities:', fallbackError.message);
                        window.cityInfo = defaultCities;
                    }
                }
            }

            // Load cities on page load
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', loadCitiesFromProperties);
            } else {
                loadCitiesFromProperties();
            }

            // Also try to load helper script if available
            var s = document.createElement('script');
            s.src = 'js/locations-sync.js';
            s.onload = function(){
                var cities = (window.roomhyLocations && typeof window.roomhyLocations.getCities === 'function') ? window.roomhyLocations.getCities() : [];
                if (cities && cities.length) {
                    window.cityInfo = cities;
                    if (typeof rebuildCityList === 'function') rebuildCityList(window.cityInfo);
                }
                // subscribe for updates from admin UI
                if (window.roomhyLocations && typeof window.roomhyLocations.onChange === 'function') {
                    window.roomhyLocations.onChange(function(c){
                        window.cityInfo = (c && c.length) ? c : defaultCities;
                        if (typeof rebuildCityList === 'function') rebuildCityList(window.cityInfo);
                    });
                }
            };
            s.onerror = function(){ window.cityInfo = defaultCities; };
            document.head.appendChild(s);
        })();
        // ======================================================
        // END: JAVASCRIPT CITY DATA
        // ======================================================
        
        // ======================================================
        // START: JAVASCRIPT PROPERTY DATA (Existing data maintained)
        // ======================================================
        const propertyData = {
            "Indore": [
                { 
                    img: "https://images.unsplash.com/photo-1570129477492-45c003edd2be?q=80&w=2070&auto:format&fit=crop", 
                    title: "Urban Stay PG", 
                    location: "Chandan Nagar, Indore", 
                    price: "7,999", 
                    oldPrice: "11,999",
                    facilities: ['wifi', 'wind', 'tv'],
                    moreFacilities: 11
                },
                { 
                    img: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?q=80&w=2070&auto:format&fit=crop", 
                    title: "Skyline Heights", 
                    location: "Chandan Nagar, Indore", 
                    price: "12,000", 
                    oldPrice: "14,500",
                    facilities: ['wifi', 'wind', 'utensils'],
                    moreFacilities: 19
                },
                { 
                    img: "https://images.unsplash.com/photo-1580587771525-78b9dba3b914?q=80&w=1974&auto:format&fit=crop", 
                    title: "Student Hostel", 
                    location: "Landmark, Indore", 
                    price: "6,000", 
                    oldPrice: "6,500",
                    facilities: ['wifi', 'tv', 'utensils'],
                    moreFacilities: 0 
                },
                { 
                    img: "https://images.unsplash.com/photo-1600585154340-be6161a5b4a4c?q=80&w=2070&auto:format&fit=crop", 
                    title: "Cozy Backpackers Hostel", 
                    location: "Landmark, Indore",
                    price: "4,500", 
                    oldPrice: "5,999",
                    facilities: ['wifi', 'wind', 'tv'],
                    moreFacilities: 13
                }
            ],
            "Kota": [
                { 
                    img: "https://images.unsplash.com/photo-1570129477492-45c003edd2be?q=80&w=2070&auto:format&fit=crop", 
                    title: "Urban Stay PG", 
                    location: "Chandan Nagar, Indore", 
                    price: "7,999", 
                    oldPrice: "11,999",
                    facilities: ['wifi', 'wind', 'tv'],
                    moreFacilities: 11
                },
                { 
                    img: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?q=80&w=2070&auto:format&fit=crop", 
                    title: "Skyline Heights", 
                    location: "Chandan Nagar, Indore", 
                    price: "12,000", 
                    oldPrice: "14,500",
                    facilities: ['wifi', 'wind', 'utensils'],
                    moreFacilities: 19
                },
                { 
                    img: "https://images.unsplash.com/photo-1580587771525-78b9dba3b914?q=80&w=1974&auto:format&fit=crop", 
                    title: "Student Hostel", 
                    location: "Landmark, Indore", 
                    price: "6,000", 
                    oldPrice: "6,500",
                    facilities: ['wifi', 'tv', 'utensils'],
                    moreFacilities: 0 
                },
                { 
                    img: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=2070&auto:format&fit=crop", 
                    title: "Cozy Backpackers Hostel", 
                    location: "Landmark, Indore",
                    price: "4,500", 
                    oldPrice: "5,999",
                    facilities: ['wifi', 'wind', 'tv'],
                    moreFacilities: 13
                }       
            ],
            // New City added: Sikkar
            "Sikkar": [
                { 
                    img: "https://images.unsplash.com/photo-1570129477492-45c003edd2be?q=80&w=2070&auto:format&fit=crop", 
                    title: "Rao's PG Hub", 
                    location: "Piprali Rd, Sikar", 
                    price: "5,999", 
                    oldPrice: "7,000",
                    facilities: ['wifi', 'tv', 'dumbbell'],
                    moreFacilities: 8
                },
                { 
                    img: "https://images.unsplash.com/photo-1557425956-783307221319?q=80&w=2070&auto:format&fit=crop", 
                    title: "Coaching Lane Hostel", 
                    location: "Fatehpur Rd, Sikar", 
                    price: "4,500", 
                    oldPrice: null,
                    facilities: ['wifi', 'wind'],
                    moreFacilities: 0 
                },
                { 
                    img: "https://images.unsplash.com/photo-1517404215738-15263e9f9178?q=80&w=2070&auto:format&fit=crop", 
                    title: "Vidya Vihar PG", 
                    location: "Bajor, Sikar",
                    price: "6,500", 
                    oldPrice: "8,000",
                    facilities: ['wifi', 'tv'],
                    moreFacilities: 13
                }
            ],
            "Gurugram": [
                { img: "https://images.unsplash.com/photo-1516455590571-18256e5bb9ff?q=80&w=2070&auto:format&fit=crop", title: "Cyber Hub Co-Living", location: "DLF Phase 3, Gurugram", price: "15,000", oldPrice: "16,000", facilities: ['wifi', 'wind', 'dumbbell'], moreFacilities: 8 },
                { img: "https://images.unsplash.com/photo-1613553483054-c3b6c5c84c6c?q=80&w=1974&auto:format&fit=crop", title: "Sector 44 Student PG", location: "Sector 44, Gurugram", price: "11,000", oldPrice: null, facilities: ['wifi', 'tv'], moreFacilities: 0 }
            ],
            "Mumbai": [
                { img: "https://images.unsplash.com/photo-1560185007-c5ca9d2c01f8?q=80&w=1974&auto:format&fit=crop", title: "Vile Parle Student Stay", location: "Vile Parle, Mumbai", price: "20,000", oldPrice: "21,500", facilities: ['wifi', 'wind'], moreFacilities: 3 },
                { img: "https://images.unsplash.com/photo-1574873215043-4411946153bc?q=80&w=2071&auto:format&fit=crop", title: "Andheri West Hostel", location: "Andheri West, Mumbai", price: "18,500", oldPrice: null, facilities: ['wifi'], moreFacilities: 0 },
                { img: "https://images.unsplash.com/photo-1616046229478-9901c5536a45?q=80&w=2070&auto:format&fit=crop", title: "Powai Lake View PG", location: "Powai, Mumbai", price: "22,000", oldPrice: "24,000", facilities: ['wifi', 'wind', 'tv'], moreFacilities: 7 }
            ],
            "Bangalore": [
                { img: "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?q=80&w=1916&auto:format&fit=crop", title: "The Scholar's Loft", location: "Koramangala, BLR", price: "16,500", oldPrice: "17,000", facilities: ['wifi', 'wind', 'tv'], moreFacilities: 10 },
                { img: "https://images.unsplash.com/photo-1555854877-bab0e564b8d5?q=80&w=2069&auto:format&fit=crop", title: "Electronic City Hub", location: "Electronic City, BLR", price: "14,000", oldPrice: null, facilities: ['wifi', 'tv'], moreFacilities: 4 }
            ],
            "Delhi": [
                { img: "https://images.unsplash.com/photo-1567016432779-1fee749a1532?q=80&w=1974&auto:format&fit=crop", title: "Campus Corner", location: "North Campus, Delhi", price: "13,000", oldPrice: "14,000", facilities: ['wifi', 'wind'], moreFacilities: 6 },
                { img: "https://images.unsplash.com/photo-1600607687930-1e3c3b9b4a4c?q=80&w=1974&auto:format&fit=crop", title: "South Ex Luxury Stay", location: "South Extension, Delhi", price: "17,000", oldPrice: "18,500", facilities: ['wifi', 'wind', 'tv'], moreFacilities: 9 }
            ]
        };
        // ======================================================
        // END: JAVASCRIPT PROPERTY DATA
        // ======================================================

        // ======================================================
        // START: JAVASCRIPT TESTIMONIAL DATA
        // ======================================================
        const testimonialData = [
            {
                img: "https://i.pravatar.cc/150?u=a042581f4e29026704d",
                name: "Priya Sharma",
                location: "Engineering Student, Christ University",
                text: "Roomhy made finding a PG in Bangalore so easy! The place was exactly as shown online. Totally trustworthy and a lifsaver for a first-timer like me."
            },
            {
                img: "https://i.pravatar.cc/150?u=a042581f4e29026704a",
                name: "Rohan Mehra",
                location: "Medical Student, AIIMS",
                text: "I was worried about finding a good hostel in Delhi. The verified listings and clear pricing on Roomhy gave me confidence. Found a great place near my campus."
            },
            {
                img: "https://i.pravatar.cc/150?u=a042581f4e29026704b",
                name: "Anjali Singh",
                location: "Design Student, NIFT",
                text: "The customer support is amazing! They helped me with all my queries before booking. The apartment I found is perfect and exactly what I needed."
            },
            {
                img: "https://i.pravatar.cc/150?u=a042581f4e29026704c",
                name: "Vikram Kumar",
                location: "IIT Student, Mumbai",
                text: "Finding a place in Mumbai within budget seemed impossible. Roomhy's map search and filter options were super helpful. Got a shared flat with great roommates."
            },
            {
                img: "https://i.pravatar.cc/150?u=a042581f4e29026704e",
                name: "Sneha Patel",
                location: "Law Student, Pune",
                text: "The zero brokerage is a huge plus. Saved a lot of money which I could use for my deposits. The platform is very transparent and easy to use."
            },
            {
                img: "https://i.pravatar.cc/150?u=a042581f4e29026704f",
                name: "Arjun Reddy",
                location: "MBA Student, ISB",
                text: "As an international student, the process was seamless. Verified properties gave me peace of mind. Booked my studio apartment from my home country."
            }
        ];
        // ======================================================
        // END: JAVASCRIPT TESTIMONIAL DATA
        // ======================================================

        // ======================================================
        // START: `rebuildCityList` FUNCTION (Replaces the infinite slider logic)
        // ======================================================
        async function rebuildCityList(data) {
            const slider = document.getElementById('cities-category-slider');
            if (!slider) return;

            // Ensure data is valid
            if (!data || !Array.isArray(data) || data.length === 0) {
                console.warn('No city data provided to rebuildCityList, using defaults');
                data = [
                    { name: "Kota", img: "https://res.cloudinary.com/dpwgvcibj/image/upload/v1768990262/roomhy/website/OIP.jpg", icon: "university" },
                    { name: "Sikar", img: "https://images.unsplash.com/photo-1549487560-671520624a9e?q=80&w=2070&auto:format&fit=crop", icon: "building-2" },
                    { name: "Indore", img: "https://images.unsplash.com/photo-1570129477492-45c003edd2be?q=80&w=2070&auto:format&fit=crop", icon: "landmark" }
                ];
            }

            // Fetch areas to get area images for each city
            let areasByCity = {};
            try {
                const apiBase = (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')
                    ? 'http://localhost:5000'
                    : 'https://roomhy-backend.onrender.com';
                const response = await fetch(`${apiBase}/api/locations/areas`);
                if (response.ok) {
                    const areaData = await response.json();
                    (areaData.data || []).forEach(area => {
                        const cityName = area.city || area.cityName;
                        if (cityName) {
                            if (!areasByCity[cityName]) {
                                areasByCity[cityName] = [];
                            }
                            if (area.imageUrl || area.image) {
                                areasByCity[cityName].push({
                                    name: area.name,
                                    img: area.imageUrl || area.image
                                });
                            }
                        }
                    });
                }
            } catch (error) {
                console.log('Could not fetch areas:', error.message);
            }

            // Function to generate a single city card HTML with carousel
            const generateCityCard = (city, areaImages) => {
                const areaList = areaImages || areasByCity[city.name] || [];
                const carouselId = `carousel-${city.name.replace(/\s+/g, '-')}`;
                
                return `
                <div class="city-filter group flex flex-col items-center justify-start text-center flex-shrink-0 w-28 space-y-2 cursor-pointer" onclick="handleCityClick('${city.name}')">
                    <div class="w-24 h-24 rounded-full relative overflow-hidden neon-border" id="${carouselId}" onmouseenter="startAreaCarousel(this);" onmouseleave="stopAreaCarousel(this);">
                        <!-- City Image (always visible initially) -->
                        <img src="${city.img || ''}" alt="Photo of ${city.name}" class="absolute inset-0 w-full h-full object-cover city-main-image transition-opacity duration-500" data-index="0">
                        
                        <!-- Area Images (carousel, hidden initially) -->
                        ${areaList.map((area, idx) => `
                            <img src="${area.img}" alt="Area: ${area.name}" class="absolute inset-0 w-full h-full object-cover city-area-image opacity-0 transition-opacity duration-500" data-index="${idx + 1}" data-area-name="${area.name}">
                        `).join('')}
                        
                        <!-- Fallback avatar -->
                        <div class="absolute inset-0 z-10 flex items-center justify-center bg-gray-100 text-3xl font-bold text-gray-700 city-avatar hidden"></div>
                        <!-- Icon overlay -->
                        <div class="absolute inset-0 z-20 w-full h-full bg-white flex items-center justify-center transition-opacity duration-500 ease-in-out group-hover:opacity-0 group-focus:opacity-0 city-overlay-icon">
                            <i data-lucide="${city.icon || 'map-pin'}" class="w-9 h-9 text-gray-600"></i>
                        </div>
                    </div>
                    <h3 class="text-sm font-medium text-gray-800 leading-tight">${city.name}</h3>
                </div>
                `;
            };

            // Build the cards with carousel support
            let cardsHTML = '';
            data.forEach(city => {
                cardsHTML += generateCityCard(city, areasByCity[city.name] || []);
            });

            slider.innerHTML = cardsHTML;

            // Re-run lucide icons for the new elements
            lucide.createIcons();

            // Setup carousel rotation functions
            window.startAreaCarousel = function(element) {
                const carouselId = element.id;
                const container = document.getElementById(carouselId);
                if (!container) return;
                
                const areaImages = container.querySelectorAll('.city-area-image');
                if (areaImages.length === 0) return;

                // Start rotating through area images every 1.5 seconds
                const rotationKey = `carousel-${carouselId}`;
                if (window[rotationKey]) clearInterval(window[rotationKey]);
                
                let currentIndex = 0;
                window[rotationKey] = setInterval(() => {
                    // Hide all area images
                    areaImages.forEach(img => img.classList.add('opacity-0'));
                    
                    // Show next area image
                    currentIndex = (currentIndex + 1) % areaImages.length;
                    areaImages[currentIndex].classList.remove('opacity-0');
                }, 1500);
                
                // Show first area image immediately
                areaImages[0].classList.remove('opacity-0');
            };

            window.stopAreaCarousel = function(element) {
                const carouselId = element.id;
                const container = document.getElementById(carouselId);
                if (!container) return;

                const rotationKey = `carousel-${carouselId}`;
                if (window[rotationKey]) {
                    clearInterval(window[rotationKey]);
                    window[rotationKey] = null;
                }

                // Hide all area images and show city image
                const mainImage = container.querySelector('.city-main-image');
                const areaImages = container.querySelectorAll('.city-area-image');
                areaImages.forEach(img => img.classList.add('opacity-0'));
                if (mainImage) mainImage.classList.remove('opacity-0');
            };

            // Show letter-avatar fallback when image missing or fails to load
            document.querySelectorAll('.city-main-image').forEach(img => {
                const card = img.closest('.city-filter');
                const name = card.querySelector('h3').textContent.trim();
                const fallback = card.querySelector('.city-avatar');
                const overlay = card.querySelector('.city-overlay-icon');

                function showFallback(){
                    if(fallback){ fallback.textContent = name ? name[0].toUpperCase() : '?'; fallback.classList.remove('hidden'); }
                    img.classList.add('hidden');
                    if(overlay) overlay.classList.remove('hidden');
                }

                const src = img.getAttribute('src') || img.src || '';
                const isLocalPlaceholder = src && src.toString().toLowerCase().includes('images/');
                
                if(!src || isLocalPlaceholder){
                    showFallback();
                } else {
                    if(img.complete){
                        if(img.naturalWidth === 0) showFallback();
                    } else {
                        img.addEventListener('error', showFallback);
                        img.addEventListener('load', () => { 
                            if(fallback) fallback.classList.add('hidden'); 
                            img.classList.remove('hidden'); 
                        });
                    }
                }
            });

            // Re-attach click listeners to navigate to property page
            document.querySelectorAll('.city-filter h3').forEach(heading => {
                heading.addEventListener('click', function(e) {
                    const cityName = this.textContent.trim();
                    window.location.href = `ourproperty.html?city=${encodeURIComponent(cityName)}`;
                });
            });
        }
        // ======================================================
        // END: `rebuildCityList` FUNCTION
        // ======================================================

        // ======================================================
        // START: AREA CAROUSEL FUNCTIONS
        // ======================================================
        let carouselIntervals = new Map();

        function startAreaCarousel(element) {
            const images = element.querySelectorAll('img');
            if (images.length <= 1) return; // No area images to carousel

            let currentIndex = 1; // Start from first area image (index 1)
            const totalAreaImages = images.length - 1; // Exclude city image

            // Clear any existing interval for this element
            if (carouselIntervals.has(element)) {
                clearInterval(carouselIntervals.get(element));
            }

            // Immediately show first area image
            images.forEach((img, idx) => {
                img.style.opacity = idx === 1 ? '1' : '0';
            });

            const interval = setInterval(() => {
                // Hide all images
                images.forEach(img => img.style.opacity = '0');

                // Show next area image
                currentIndex = ((currentIndex - 1 + 1) % totalAreaImages) + 1; // Cycle from 1 to total-1
                images[currentIndex].style.opacity = '1';
            }, 2000); // Change image every 2 seconds

            carouselIntervals.set(element, interval);
        }

        function stopAreaCarousel(element) {
            // Clear interval
            if (carouselIntervals.has(element)) {
                clearInterval(carouselIntervals.get(element));
                carouselIntervals.delete(element);
            }

            // Reset to first image (city image)
            const images = element.querySelectorAll('img');
            images.forEach((img, index) => {
                img.style.opacity = index === 0 ? '1' : '0';
            });
        }
        // ======================================================
        // END: AREA CAROUSEL FUNCTIONS
        // ======================================================

        // ======================================================
        // START: `selectCity` FUNCTION (Filter properties by city on page)
        // ======================================================
        function selectCity(city) {
            const topSpaces = document.getElementById('top-spaces');
            if (topSpaces) {
                topSpaces.style.display = 'block';
                const title = document.getElementById('top-spaces-title');
                if (title) title.textContent = `Top Spaces in ${city}`;
                loadPropertiesForCity(city, 'spaces-slider');
                // Scroll to the section smoothly
                topSpaces.scrollIntoView({ behavior: 'smooth' });
            }
        }
        // ======================================================
        // END: `selectCity` FUNCTION
        // ======================================================


        // ======================================================
        // START: `updateTopSpaces` FUNCTION (FOR INDORE)
        // ======================================================
        function updateTopSpaces(cityName) {
            const spacesTitle = document.getElementById('top-spaces-title');
            const spacesSlider = document.querySelector('#top-spaces #spaces-slider');
            
            if (!spacesTitle || !spacesSlider) {
                console.error("Could not find 'top-spaces-title' or 'spaces-slider'.");
                return;
            }

            // Fallback to Indore if city data is missing
            const spaces = propertyData[cityName] || propertyData["Indore"]; 
            
            spacesTitle.innerText = `Top Spaces in ${cityName}`;
            spacesSlider.innerHTML = '';
            
            if (!spaces || spaces.length === 0) {
                spacesSlider.innerHTML = '<p class="text-gray-500 px-4">No properties found for this city.</p>';
                return;
            }
            
            let newSlidesHTML = '';
            spaces.forEach(space => {
                let facilitiesHTML = '';
                if (space.facilities && space.facilities.length > 0) {
                    facilitiesHTML = space.facilities.map(icon => 
                        `<i data-lucide="${icon}" class="w-4 h-4"></i>`
                    ).join('');
                }
                
                let moreFacilitiesHTML = '';
                if (space.moreFacilities && space.moreFacilities > 0) {
                    moreFacilitiesHTML = `<span class="text-xs font-bold text-blue-600 bg-blue-100 py-0.5 px-1.5 rounded">+${space.moreFacilities}</span>`;
                }

                let oldPriceHTML = '';
                if (space.oldPrice) {
                    oldPriceHTML = `<p class="text-xs text-gray-500 line-through">?${space.oldPrice}</p>`;
                }

                newSlidesHTML += `
                    <div class="group flex-shrink-0 snap-start w-80 lg:w-full">
                        <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden flex flex-col h-full">
                            <div class="relative">
                                <img src="${space.img}" alt="${space.title}" class="w-full h-48 object-cover">
                                <div class="absolute bottom-2 left-1/2 -translate-x-1/2 flex space-x-1.5">
                                    <span class="w-2 h-2 bg-white rounded-full opacity-90"></span>
                                    <span class="w-2 h-2 bg-white rounded-full opacity-50"></span>
                                    <span class="w-2 h-2 bg-white rounded-full opacity-50"></span>
                                    <span class="w-2 h-2 bg-white rounded-full opacity-50"></span>
                                </div>
                            </div>

                            <div class="p-4 flex flex-col flex-grow">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-lg text-gray-900">${space.title}</h3>
                                    <div class="text-right flex-shrink-0 ml-2">
                                        <p class="font-bold text-blue-600 text-lg">?${space.price}</p>
                                        ${oldPriceHTML}
                                        <p class="text-xs text-gray-500">onwards</p>
                                    </div>
                                </div>

                                <p class="text-gray-600 text-sm mt-1">${space.location}</p>

                                <div class="mt-4 pt-4 border-t border-gray-100">
                                    <h4 class="text-xs font-semibold text-gray-500 mb-2">Key Facilities</h4>
                                    <div class="flex items-center space-x-3 text-gray-600">
                                        ${facilitiesHTML}
                                        ${moreFacilitiesHTML}
                                    </div>
                                    </div>

                                <a href="#" class="block w-full text-center bg-blue-600 text-white font-medium py-2.5 px-4 rounded-lg text-sm hover:bg-blue-700 transition-colors mt-4">
                                    View Details
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            spacesSlider.innerHTML = newSlidesHTML;
            lucide.createIcons();
        }
        // ======================================================
        // END: `updateTopSpaces` FUNCTION
        // ======================================================

        // ======================================================
        // START: `updateTopSpacesKota` FUNCTION (FOR KOTA)
        // ======================================================
        function updateTopSpacesKota(cityName) {
            const spacesTitle = document.getElementById('top-spaces-title-kota');
            const spacesSlider = document.querySelector('#top-spaces-kota #spaces-slider-kota');
            
            if (!spacesTitle || !spacesSlider) {
                console.error("Could not find 'top-spaces-title-kota' or 'spaces-slider-kota'.");
                return;
            }

            const spaces = propertyData[cityName] || propertyData["Kota"]; // Fallback to Kota
            
            spacesTitle.innerText = `Top Spaces in ${cityName}`;
            spacesSlider.innerHTML = '';
            
            if (!spaces || spaces.length === 0) {
                spacesSlider.innerHTML = '<p class="text-gray-500 px-4">No properties found for this city.</p>';
                return;
            }
            
            let newSlidesHTML = '';
            spaces.forEach(space => {
                let facilitiesHTML = '';
                if (space.facilities && space.facilities.length > 0) {
                    facilitiesHTML = space.facilities.map(icon => 
                        `<i data-lucide="${icon}" class="w-4 h-4"></i>`
                    ).join('');
                }
                
                let moreFacilitiesHTML = '';
                if (space.moreFacilities && space.moreFacilities > 0) {
                    moreFacilitiesHTML = `<span class="text-xs font-bold text-blue-600 bg-blue-100 py-0.5 px-1.5 rounded">+${space.moreFacilities}</span>`;
                }

                let oldPriceHTML = '';
                if (space.oldPrice) {
                    oldPriceHTML = `<p class="text-xs text-gray-500 line-through">?${space.oldPrice}</p>`;
                }

                newSlidesHTML += `
                    <div class="group flex-shrink-0 snap-start w-80 lg:w-full">
                        <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden flex flex-col h-full">
                            <div class="relative">
                                <img src="${space.img}" alt="${space.title}" class="w-full h-48 object-cover">
                                <div class="absolute bottom-2 left-1/2 -translate-x-1/2 flex space-x-1.5">
                                    <span class="w-2 h-2 bg-white rounded-full opacity-90"></span>
                                    <span class="w-2 h-2 bg-white rounded-full opacity-50"></span>
                                    <span class="w-2 h-2 bg-white rounded-full opacity-50"></span>
                                    <span class="w-2 h-2 bg-white rounded-full opacity-50"></span>
                                </div>
                            </div>

                            <div class="p-4 flex flex-col flex-grow">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-lg text-gray-900">${space.title}</h3>
                                    <div class="text-right flex-shrink-0 ml-2">
                                        <p class="font-bold text-blue-600 text-lg">?${space.price}</p>
                                        ${oldPriceHTML}
                                        <p class="text-xs text-gray-500">onwards</p>
                                    </div>
                                </div>

                                <p class="text-gray-600 text-sm mt-1">${space.location}</p>

                                <div class="mt-4 pt-4 border-t border-gray-100">
                                    <h4 class="text-xs font-semibold text-gray-500 mb-2">Key Facilities</h4>
                                    <div class="flex items-center space-x-3 text-gray-600">
                                        ${facilitiesHTML}
                                        ${moreFacilitiesHTML}
                                    </div>
                                    </div>

                                <a href="#" class="block w-full text-center bg-blue-600 text-white font-medium py-2.5 px-4 rounded-lg text-sm hover:bg-blue-700 transition-colors mt-4">
                                    View Details
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            spacesSlider.innerHTML = newSlidesHTML;
            lucide.createIcons();
        }
        // ======================================================
        // END: `updateTopSpacesKota` FUNCTION
        // ======================================================

        // ======================================================
        // START: `updateFeaturedProperties` FUNCTION (Button Text Changed, Desktop Slider changed)
        // ======================================================
        function updateFeaturedProperties() {
            const spacesSlider = document.querySelector('#featured #featured-slider');
            
            if (!spacesSlider) {
                console.error("Could not find '#featured-slider'.");
                return;
            }

            // Fetch trending enquiries from MongoDB API
            fetch(API_URL + '/api/website-enquiry/all')
                .then(response => {
                    if (!response.ok) throw new Error('Failed to fetch properties');
                    return response.json();
                })
                .then(data => {
                    const enquiries = data.enquiries || [];
                    
                    if (enquiries.length === 0) {
                        spacesSlider.innerHTML = '<p class="text-gray-500 px-4">No properties available at the moment.</p>';
                        return;
                    }

                    // Convert enquiries to property format (just use first 4 for trending)
                    const properties = enquiries.slice(0, 8).map((enq, idx) => ({
                        img: enq.photos && enq.photos.length > 0 ? enq.photos[0] : 'https://images.unsplash.com/photo-1567016432779-1fee749a1532?q=80&w=1974&auto=format&fit=crop',
                        title: enq.property_name,
                        location: `${enq.locality || ''}, ${enq.city}`.trim(),
                        price: enq.rent || 'Contact',
                        facilities: enq.amenities || [],
                        id: enq.enquiry_id
                    }));

                    renderTrendingProperties(properties, spacesSlider);
                })
                .catch(error => {
                    console.error('Error fetching trending properties:', error);
                    // Fallback to hardcoded data
                    const fallbackSpaces = propertyData["Indore"] || [];
                    if (fallbackSpaces.length > 0) {
                        renderTrendingProperties(fallbackSpaces, spacesSlider);
                    } else {
                        spacesSlider.innerHTML = '<p class="text-gray-500 px-4">Unable to load properties at the moment.</p>';
                    }
                });
        }

        // ======================================================
        // RENDER TRENDING PROPERTIES
        // ======================================================
        function renderTrendingProperties(spaces, spacesSlider) {
            if (!spaces || spaces.length === 0) {
                spacesSlider.innerHTML = '<p class="text-gray-500 px-4">No properties found.</p>';
                return;
            }

            let newSlidesHTML = '';
            spaces.forEach(space => {
                let facilitiesHTML = '';
                if (space.facilities && space.facilities.length > 0) {
                    const amenitiesList = Array.isArray(space.facilities) ? space.facilities : [];
                    facilitiesHTML = amenitiesList.slice(0, 3).map(amenity => {
                        // Map amenity names to lucide icons
                        const iconMap = {
                            'wifi': 'wifi', 'ac': 'wind', 'tv': 'tv', 'laundry': 'shirt',
                            'parking': 'car', 'food': 'utensils', 'gym': 'dumbbell'
                        };
                        const icon = iconMap[amenity.toLowerCase()] || 'star';
                        return `<i data-lucide="${icon}" class="w-4 h-4"></i>`;
                    }).join('');
                }

                const price = typeof space.price === 'number' ? space.price.toLocaleString() : space.price;
                
                newSlidesHTML += `
                    <div class="group flex-shrink-0 snap-start w-80 lg:w-96">
                        <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden flex flex-col h-full">
                            <div class="relative">
                                <img src="${space.img}" alt="${space.title}" class="w-full h-48 object-cover">
                                <div class="absolute bottom-2 left-1/2 -translate-x-1/2 flex space-x-1.5">
                                    <span class="w-2 h-2 bg-white rounded-full opacity-90"></span>
                                    <span class="w-2 h-2 bg-white rounded-full opacity-50"></span>
                                    <span class="w-2 h-2 bg-white rounded-full opacity-50"></span>
                                    <span class="w-2 h-2 bg-white rounded-full opacity-50"></span>
                                </div>
                            </div>

                            <div class="p-4 flex flex-col flex-grow">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-bold text-lg text-gray-900">${space.title}</h3>
                                        <p class="text-gray-600 text-sm mt-1">${space.location}</p>
                                    </div>
                                    <div class="text-right flex-shrink-0 ml-2">
                                        <p class="font-bold text-gray-900 text-lg">?${price}</p>
                                        <p class="text-xs text-gray-500">onwards</p>
                                    </div>
                                </div>

                                <div class="mt-4 pt-4 border-t border-gray-100">
                                    <h4 class="text-xs font-semibold text-gray-500 mb-2">Key Facilities</h4>
                                    <div class="flex items-center space-x-3 text-gray-600">
                                        ${facilitiesHTML}
                                    </div>
                                </div>

                                <a href="property.html?id=${space.id || ''}" class="block w-full text-center bg-blue-600 text-white font-medium py-2 px-4 rounded-lg text-sm hover:bg-blue-700 transition-colors mt-auto pt-2.5">
                                    View Details
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            spacesSlider.innerHTML = newSlidesHTML;
            lucide.createIcons();
        }
        // ======================================================
        // END: RENDER TRENDING PROPERTIES
        // ======================================================

        // ======================================================
        // START: DYNAMIC TOP SPACES LOADER (FROM API)
        // ======================================================
        function loadDynamicTopSpaces() {
            // Get cities from MongoDB API (with localStorage fallback)
            async function getCities() {
                try {
                    const response = await fetch(`${API_URL}/api/cities`);
                    if (!response.ok) throw new Error('API failed');
                    const data = await response.json();
                    return (data.data || []).map(c => c.name);
                } catch (err) {
                    console.log('Fallback to localStorage for cities:', err);
                    // Fallback: Get cities from localStorage
                    let citiesData = JSON.parse(localStorage.getItem('roomhy_cities') || '[]');
                    return citiesData.map(city => {
                        if (typeof city === 'string') return city;
                        if (typeof city === 'object' && city.name) return city.name;
                        return null;
                    }).filter(city => city !== null);
                }
            }

            getCities().then(cityNames => {
                // Filter out hardcoded cities (Indore and Kota)
                const customCities = cityNames.filter(city => 
                    city.toLowerCase() !== 'indore' && city.toLowerCase() !== 'kota'
                );
                
                if (customCities.length === 0) {
                    console.log('No custom cities configured. Top Spaces sections hidden.');
                    return;
                }
                
                // Find the city with the most properties
                const promises = customCities.map(city => 
                    fetch(`${API_URL}/api/website-enquiry/city/${encodeURIComponent(city)}`)
                        .then(res => res.json())
                        .then(data => ({
                            city: city,
                            count: (data.enquiries || []).length,
                            enquiries: data.enquiries || []
                        }))
                        .catch(err => {
                            console.error(`Error fetching data for ${city}:`, err);
                            return {
                                city: city,
                                count: 0,
                                enquiries: []
                            };
                    })
            );
            
            Promise.all(promises).then(results => {
                // Filter out cities with no properties
                const validResults = results.filter(r => r.count > 0);
                
                if (validResults.length === 0) {
                    console.log('No properties found in any city.');
                    return;
                }
                
                // Find city with highest property count
                const topCity = validResults.reduce((max, current) => 
                    current.count > max.count ? current : max
                );
                
                // Find the container to insert the section
                const topSpacesKotaSection = document.getElementById('top-spaces-kota');
                if (!topSpacesKotaSection) {
                    console.log('Could not find top-spaces-kota container');
                    return;
                }
                
                const container = topSpacesKotaSection.parentElement;
                const sectionId = `top-spaces-${topCity.city.toLowerCase().replace(/\s+/g, '-')}`;
                const sliderId = `spaces-slider-${topCity.city.toLowerCase().replace(/\s+/g, '-')}`;
                
                // Check if section already exists
                if (document.getElementById(sectionId)) return;
                
                const sectionHTML = `
                    <section id="${sectionId}" class="light-card rounded-2xl p-6">
                        <h2 id="${sectionId}-title" class="text-2xl md:text-3xl font-bold mb-6 text-gray-900">Top Spaces in ${topCity.city}</h2>
                        <div class="relative -m-2">
                            <button class="spaces-prev-btn hidden absolute -left-2 top-1/2 -translate-y-1/2 z-10 p-2 bg-white rounded-full shadow-md hover:bg-gray-100 text-gray-700 sm:block lg:hidden" data-slider="${sliderId}">
                                <i data-lucide="chevron-left" class="w-6 h-6"></i>
                            </button>
                            <div id="${sliderId}" class="flex gap-6 overflow-x-auto pb-2 pt-2 -mx-4 px-4 snap-x snap-mandatory scroll-smooth horizontal-slider lg:grid lg:grid-cols-4 lg:gap-6 lg:overflow-visible lg:p-0 lg:m-0">
                                <!-- Dynamic content will be loaded here -->
                            </div>
                            <button class="spaces-next-btn hidden absolute -right-2 top-1/2 -translate-y-1/2 z-10 p-2 bg-white rounded-full shadow-md hover:bg-gray-100 text-gray-700 sm:block lg:hidden" data-slider="${sliderId}">
                                <i data-lucide="chevron-right" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </section>
                `;
                
                // Insert before the 'why-choose-us' section
                const whyChooseUs = document.getElementById('why-choose-us');
                if (whyChooseUs) {
                    whyChooseUs.insertAdjacentHTML('beforebegin', sectionHTML);
                } else {
                    container.appendChild(new DOMParser().parseFromString(sectionHTML, 'text/html').body.firstChild);
                }
                
                // Render properties for the top city
                const slider = document.getElementById(sliderId);
                if (slider && topCity.enquiries.length > 0) {
                    const spaces = topCity.enquiries.slice(0, 4).map(enq => ({
                        img: enq.photos && enq.photos.length > 0 ? enq.photos[0] : 'https://images.unsplash.com/photo-1567016432779-1fee749a1532?q=80&w=1974&auto=format&fit=crop',
                        title: enq.property_name,
                        location: `${enq.locality || ''}, ${enq.city}`.trim(),
                        price: enq.rent || 'Contact',
                        facilities: enq.amenities || [],
                        id: enq.enquiry_id
                    }));
                    renderPropertySlider(spaces, slider);
                    // Re-run lucide icons for the new HTML
                    lucide.createIcons();
                } else {
                    slider.innerHTML = '<p class="text-gray-500 px-4">No properties available for this city yet.</p>';
                }
            });
            }).catch(err => {
                console.error('Error loading cities:', err);
                // If all fails, just don't show the dynamic section
            });
        }
        
        // ======================================================
        // LOAD PROPERTIES FOR A SPECIFIC CITY
        // ======================================================
        function loadPropertiesForCity(city, sliderId) {
            const slider = document.getElementById(sliderId);
            
            if (!slider) return;
            
            // Fetch properties from MongoDB API for this specific city
            fetch(`${API_URL}/api/website-enquiry/city/${encodeURIComponent(city)}`)
                .then(response => {
                    if (!response.ok) throw new Error('Failed to fetch properties');
                    return response.json();
                })
                .then(data => {
                    const enquiries = data.enquiries || [];
                    
                    if (enquiries.length === 0) {
                        slider.innerHTML = '<p class="text-gray-500 px-4">No properties available for this city yet.</p>';
                        return;
                    }
                    
                    // Convert enquiries to property format
                    const spaces = enquiries.slice(0, 4).map(enq => ({
                        img: enq.photos && enq.photos.length > 0 ? enq.photos[0] : 'https://images.unsplash.com/photo-1567016432779-1fee749a1532?q=80&w=1974&auto=format&fit=crop',
                        title: enq.property_name,
                        location: `${enq.locality || ''}, ${enq.city}`.trim(),
                        price: enq.rent || 'Contact',
                        facilities: enq.amenities || [],
                        id: enq.enquiry_id
                    }));
                    
                    renderPropertySlider(spaces, slider);
                })
                .catch(error => {
                    console.error(`Error fetching properties for ${city}:`, error);
                    // Try fallback to propertyData
                    const spaces = propertyData[city];
                    if (spaces && spaces.length > 0) {
                        renderPropertySlider(spaces, slider);
                    } else {
                        slider.innerHTML = '<p class="text-gray-500 px-4">No properties available for this city yet.</p>';
                    }
                });
        }
        
        // ======================================================
        // RENDER PROPERTY SLIDER
        // ======================================================
        function renderPropertySlider(spaces, slider) {
            let html = '';
            spaces.forEach(space => {
                let facilitiesHTML = '';
                if (space.facilities && space.facilities.length > 0) {
                    facilitiesHTML = space.facilities.map(icon => 
                        `<i data-lucide="${icon}" class="w-4 h-4"></i>`
                    ).join('');
                }
                
                let moreFacilitiesHTML = '';
                if (space.moreFacilities && space.moreFacilities > 0) {
                    moreFacilitiesHTML = `<span class="text-xs font-bold text-blue-600 bg-blue-100 py-0.5 px-1.5 rounded">+${space.moreFacilities}</span>`;
                }

                let oldPriceHTML = '';
                if (space.oldPrice) {
                    oldPriceHTML = `<p class="text-xs text-gray-500 line-through">?${space.oldPrice}</p>`;
                }

                html += `
                    <div class="group flex-shrink-0 snap-start w-80 lg:w-full">
                        <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden flex flex-col h-full">
                            <div class="relative">
                                <img src="${space.img}" alt="${space.title}" class="w-full h-48 object-cover">
                                <div class="absolute bottom-2 left-1/2 -translate-x-1/2 flex space-x-1.5">
                                    <span class="w-2 h-2 bg-white rounded-full opacity-90"></span>
                                    <span class="w-2 h-2 bg-white rounded-full opacity-50"></span>
                                    <span class="w-2 h-2 bg-white rounded-full opacity-50"></span>
                                    <span class="w-2 h-2 bg-white rounded-full opacity-50"></span>
                                </div>
                            </div>

                            <div class="p-4 flex flex-col flex-grow">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-lg text-gray-900">${space.title}</h3>
                                    <div class="text-right flex-shrink-0 ml-2">
                                        <p class="font-bold text-blue-600 text-lg">?${space.price}</p>
                                        ${oldPriceHTML}
                                        <p class="text-xs text-gray-500">onwards</p>
                                    </div>
                                </div>

                                <p class="text-gray-600 text-sm mt-1">${space.location}</p>

                                <div class="mt-4 pt-4 border-t border-gray-100">
                                    <h4 class="text-xs font-semibold text-gray-500 mb-2">Key Facilities</h4>
                                    <div class="flex items-center space-x-3 text-gray-600">
                                        ${facilitiesHTML}
                                        ${moreFacilitiesHTML}
                                    </div>
                                </div>

                                <a href="#" class="block w-full text-center bg-blue-600 text-white font-medium py-2.5 px-4 rounded-lg text-sm hover:bg-blue-700 transition-colors mt-4">
                                    View Details
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            slider.innerHTML = html;
            lucide.createIcons();
        }
        // ======================================================
        // END: `renderTrendingProperties` FUNCTION
        // ======================================================

        // ======================================================
        // START: `buildTestimonialRow` FUNCTION (Updated for size/text box)
        // ======================================================
        function buildTestimonialRow(data, containerId) {
            const track = document.getElementById(containerId);
            if (!track) return;

            let cardsHTML = '';
            data.forEach(item => {
                cardsHTML += `
                    <div class="testimonial-card">
                        <div class="flex items-start mb-4">
                            <img src="${item.img}" alt="${item.name}" class="w-12 h-12 rounded-full mr-4 flex-shrink-0">
                            <div>
                                <h4 class="font-bold text-gray-900">${item.name}</h4>
                                <p class="text-sm text-gray-500">${item.location}</p>
                            </div>
                        </div>
                        <div class="flex mb-3">
                            <i data-lucide="star" class="w-5 h-5 text-yellow-400 fill-current"></i>
                            <i data-lucide="star" class="w-5 h-5 text-yellow-400 fill-current"></i>
                            <i data-lucide="star" class="w-5 h-5 text-yellow-400 fill-current"></i>
                            <i data-lucide="star" class="w-5 h-5 text-yellow-400 fill-current"></i>
                            <i data-lucide="star" class="w-5 h-5 text-yellow-400 fill-current"></i>
                        </div>
                        <p class="text-gray-600 text-base break-words whitespace-normal">${item.text}</p>
                    </div>
                `;
            });
            
            // Duplicate the cards to create a seamless loop
            track.innerHTML = cardsHTML + cardsHTML;
        }
        // ======================================================
        // END: `buildTestimonialRow` FUNCTION
        // ======================================================


        /*
         * Original logic to enable tap-to-toggle visual effect on touch devices.
         * This function IS NOT running now.
         */
        function enableTouchCityEffects(){
            const cityEls = document.querySelectorAll('.city-filter');
            if (!cityEls || cityEls.length === 0) return;

            // Apply pointerdown so it works for touch and mouse (quick visual feedback)
            cityEls.forEach(el => {
                el.addEventListener('pointerdown', (ev) => {
                    // Remove active from others
                    document.querySelectorAll('.city-filter.is-active').forEach(a => a.classList.remove('is-active'));
                    // Add to this element
                    el.classList.add('is-active');
                });

                // After click, keep the visual for a short moment so it's noticeable on mobile
                el.addEventListener('click', (ev) => {
                    setTimeout(() => el.classList.remove('is-active'), 600);
                });
            });

            // Remove active class when tapping/clicking outside the city items
            document.addEventListener('click', (ev) => {
                if (!ev.target.closest || !ev.target.closest('.city-filter')) {
                    document.querySelectorAll('.city-filter.is-active').forEach(a => a.classList.remove('is-active'));
                }
            });
        }
        

        // ======================================================
        // START: HOW IT WORKS SCROLL ANIMATION LOGIC
        // (UPDATED to use DOTTED lines and manage dasharray/dashoffset)
        // ======================================================

        const howItWorksSection = document.getElementById('how-it-works');
        const path1 = document.getElementById('path1');
        const path2 = document.getElementById('path2');
        const stepCards = document.querySelectorAll('.step-card-3d');

        // Initial setup function
        function setupHowItWorksPaths() {
            if (!path1 || !path2) return;
            
            if (window.innerWidth < 1024) {
                // Mobile: Enable infinite flow animation
                path1.classList.add('flow-infinite');
                path2.classList.add('flow-infinite');
                path1.classList.remove('draw-on-scroll');
                path2.classList.remove('draw-on-scroll');
                path1.style.strokeDashoffset = '0'; // Reset offset for infinite animation
                path2.style.strokeDashoffset = '0';
                return; 
            }
            
            // Desktop: Enable scroll drawing
            path1.classList.add('draw-on-scroll');
            path2.classList.add('draw-on-scroll');
            path1.classList.remove('flow-infinite');
            path2.classList.remove('flow-infinite');
            
            // Calculate total length
            const path1Length = path1.getTotalLength();
            const path2Length = path2.getTotalLength();
            
            // Hide the line initially by setting offset = length
            path1.style.strokeDashoffset = path1Length; 
            path2.style.strokeDashoffset = path2Length; 
            
            // Store lengths for use in scroll listener
            path1.dataset.length = path1Length;
            path2.dataset.length = path2Length;
            
            // Re-check visibility after resize/setup to correctly position lines
            updatePathDrawing();
        }

        function updatePathDrawing() {
            if (!path1 || !path2 || window.innerWidth < 1024) {
                return; // Only run on desktop screens (lg: breakpoint)
            }
            
            // Get lengths from data attributes
            const path1Length = parseFloat(path1.dataset.length);
            const path2Length = parseFloat(path2.dataset.length);

            const scrollY = window.scrollY;
            const sectionTop = howItWorksSection.offsetTop;
            const sectionHeight = howItWorksSection.offsetHeight;
            const viewportHeight = window.innerHeight;

            // Define the scroll window where the animation runs
            const scrollRange = sectionHeight * 1.5; // Start drawing earlier
            const scrollStart = sectionTop - viewportHeight + 100; // Start drawing when the section is about 100px from the bottom of the viewport
            
            let scrollProgress = (scrollY - scrollStart) / scrollRange;
            scrollProgress = Math.min(1, Math.max(0, scrollProgress)); // Clamp 0 to 1

            // Line 1 should be fully drawn by 50% scroll progress (0 to 0.5)
            let progress1 = Math.min(1, scrollProgress * 2); 
            
            // Line 2 starts drawing at 50% and should be fully drawn by 100% scroll progress (0.5 to 1.0)
            let progress2 = Math.min(1, Math.max(0, (scrollProgress - 0.5) * 2)); 

            // Calculate offset based on progress (Drawn line's dashoffset decreases from Length to 0)
            path1.style.strokeDashoffset = path1Length * (1 - progress1);
            path2.style.strokeDashoffset = path2Length * (1 - progress2);
        }

        // Intersection Observer for Step Card Reveal
        const stepCardObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.3, rootMargin: '0px 0px -50px 0px' });

        stepCards.forEach(card => {
            stepCardObserver.observe(card);
        });

        window.addEventListener('scroll', updatePathDrawing);
        window.addEventListener('resize', setupHowItWorksPaths); // Recalculate on resize
        
        // Initial setup for path lengths and icons
        document.addEventListener('DOMContentLoaded', () => {
            // Build the city list with hover effects
            rebuildCityList(window.cityInfo);

            // Hide hardcoded Indore and Kota sections
            const topSpacesIndore = document.getElementById('top-spaces');
            const topSpacesKota = document.getElementById('top-spaces-kota');
            if (topSpacesIndore) topSpacesIndore.style.display = 'none';
            if (topSpacesKota) topSpacesKota.style.display = 'none';

            // Load dynamic Top Spaces sections for each city from localStorage
            loadDynamicTopSpaces();

            // Load featured/trending properties from MongoDB
            updateFeaturedProperties();

            // Build testimonial rows
            buildTestimonialRow(testimonialData.slice(0, 3), 'testimonial-track-1');
            buildTestimonialRow(testimonialData.slice(3, 6), 'testimonial-track-2');
            
            // Re-run lucide.createIcons() after dynamic content
            lucide.createIcons();
            
            // Initial call to set path lengths and positions for DOTTED SCROLL DRAWING/FLOWING
            setupHowItWorksPaths();
            // Initial call to draw path based on current scroll position
            updatePathDrawing(); 
        });

        // ======================================================
        // END: HOW IT WORKS SCROLL ANIMATION LOGIC
        // ======================================================

        // ======================================================
        // DYNAMIC SLIDER NAVIGATION (Top Spaces & Featured)
        // ======================================================
        document.addEventListener('click', (e) => {
            // Handle slider navigation buttons
            const prevBtn = e.target.closest('.spaces-prev-btn, .offer-prev, #offer-prev, #featured-prev');
            const nextBtn = e.target.closest('.spaces-next-btn, .offer-next, #offer-next, #featured-next');
            
            if (prevBtn) {
                const sliderId = prevBtn.dataset.slider || prevBtn.closest('.relative')?.querySelector('[class*="slider"]')?.id;
                const slider = document.getElementById(sliderId);
                if (slider) {
                    slider.scrollBy({ left: -300, behavior: 'smooth' });
                }
            }
            
            if (nextBtn) {
                const sliderId = nextBtn.dataset.slider || nextBtn.closest('.relative')?.querySelector('[class*="slider"]')?.id;
                const slider = document.getElementById(sliderId);
                if (slider) {
                    slider.scrollBy({ left: 300, behavior: 'smooth' });
                }
            }
        });

        // ======================================================
        const menuToggle = document.getElementById('menu-toggle');
        const menuClose = document.getElementById('menu-close');
        const mobileMenu = document.getElementById('mobile-menu');
        const menuOverlay = document.getElementById('menu-overlay');

        if (menuToggle && mobileMenu && menuClose && menuOverlay) {
            menuToggle.addEventListener('click', () => {
                mobileMenu.classList.remove('translate-x-full');
                menuOverlay.classList.remove('hidden');
            });

            const closeMenu = () => {
                mobileMenu.classList.add('translate-x-full');
                menuOverlay.classList.add('hidden');
            };

            menuClose.addEventListener('click', closeMenu);
            menuOverlay.addEventListener('click', closeMenu);

            mobileMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', closeMenu);
            });
        }
        
        // Intersection Observer for general animations
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate-slide-in');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('section > div:not(.relative):not(#hero-content-wrapper), section > h2').forEach(el => {
            // Exclude the step cards which have their own observer
            if (!el.closest('#how-it-works') && !el.classList.contains('animate-slide-in')) {
                 el.style.opacity = '0';
                 observer.observe(el);
            }
        });


        // Intersection Observer for offering cards
        const cardObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach((entry, index) => {
                if (entry.isIntersecting) {
                    entry.target.style.animationDelay = `${index * 100}ms`;
                    entry.target.classList.add('card-animate');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.2 });

        document.querySelectorAll('.offering-card-item').forEach(card => {
            cardObserver.observe(card);
        });

        // Offerings Slider
        const offerSlider = document.getElementById('offerings-slider');
        const offerPrev = document.getElementById('offer-prev');
        const offerNext = document.getElementById('offer-next');
        if(offerSlider && offerPrev && offerNext) {
            const offerCardWidth = 240 + 20; // w-48 (192px) + gap-5 (20px)
            offerNext.addEventListener('click', () => {
                offerSlider.scrollBy({ left: offerCardWidth, behavior: 'smooth' });
            });
            offerPrev.addEventListener('click', () => {
                offerSlider.scrollBy({ left: -offerCardWidth, behavior: 'smooth' });
            });
        }

        // ======================================================
        // "TOP SPACES (INDORE)" SLIDER JAVASCRIPT
        // ======================================================
        const spacesSlider = document.getElementById('spaces-slider');
        const spacesPrev = document.getElementById('spaces-prev');
        const spacesNext = document.getElementById('spaces-next');
        if(spacesSlider && spacesPrev && spacesNext) {
            const spaceCardWidth = 320 + 24; // w-80 (320px) + gap-6 (24px)
            spacesNext.addEventListener('click', () => {
                spacesSlider.scrollBy({ left: spaceCardWidth, behavior: 'smooth' });
            });
            spacesPrev.addEventListener('click', () => {
                spacesSlider.scrollBy({ left: -spaceCardWidth, behavior: 'smooth' });
            });
        }
        // ======================================================
        // "TOP SPACES (KOTA)" SLIDER JAVASCRIPT
        // ======================================================
        const spacesSliderKota = document.getElementById('spaces-slider-kota');
        const spacesPrevKota = document.getElementById('spaces-prev-kota');
        const spacesNextKota = document.getElementById('spaces-next-kota');
        if(spacesSliderKota && spacesPrevKota && spacesNextKota) {
            const spaceCardWidth = 320 + 24; // w-80 (320px) + gap-6 (24px)
            spacesNextKota.addEventListener('click', () => {
                spacesSliderKota.scrollBy({ left: spaceCardWidth, behavior: 'smooth' });
            });
            spacesPrevKota.addEventListener('click', () => {
                spacesSliderKota.scrollBy({ left: -spaceCardWidth, behavior: 'smooth' });
            });
        }
        
        // Featured Stays Slider
        const featuredSlider = document.getElementById('featured-slider');
        const featuredPrev = document.getElementById('featured-prev');
        const featuredNext = document.getElementById('featured-next');
        if(featuredSlider && featuredPrev && featuredNext) {
            // Note: Updated `featuredNext` and `featuredPrev` to use `scrollBy` method correctly
            const featuredCardWidth = 384 + 24; // w-96 (384px) + gap-6 (24px) for desktop/wider cards
            featuredNext.addEventListener('click', () => {
                featuredSlider.scrollBy({ left: featuredCardWidth, behavior: 'smooth' });
            });
            featuredPrev.addEventListener('click', () => {
                featuredSlider.scrollBy({ left: -featuredCardWidth, behavior: 'smooth' });
            });
        }

        /*
        ============================================================
        Hero Slideshow
        ============================================================
        */
        const heroWrapper = document.getElementById('hero-image-wrapper');
        if (heroWrapper) {
            const heroImages = heroWrapper.querySelectorAll('img');
            const totalHeroImages = heroImages.length;
            let currentHeroIndex = 0;

            if (totalHeroImages > 1) {
                setInterval(() => {
                    const nextHeroIndex = (currentHeroIndex + 1) % totalHeroImages;
                    
                    heroImages[currentHeroIndex].classList.remove('opacity-100');
                    heroImages[currentHeroIndex].classList.add('opacity-0');
                    
                    heroImages[nextHeroIndex].classList.remove('opacity-0');
                    heroImages[nextHeroIndex].classList.add('opacity-100');
                    
                    currentHeroIndex = nextHeroIndex;
                }, 5000);
            }
        }
        
        /*
        ============================================================
        FAQ Accordion Logic
        ============================================================
        */
        document.querySelectorAll('.faq-item').forEach(item => {
            const question = item.querySelector('.faq-question');
            const answer = item.querySelector('.faq-answer');
            const chevron = item.querySelector('.chevron');
            
            question.addEventListener('click', () => {
                // Close all other open answers
                document.querySelectorAll('.faq-answer.active').forEach(activeAnswer => {
                    if (activeAnswer !== answer) {
                        activeAnswer.classList.remove('active');
                        activeAnswer.previousElementSibling.querySelector('.chevron').classList.remove('rotated');
                    }
                });

                // Toggle the clicked answer
                answer.classList.toggle('active');
                chevron.classList.toggle('rotated');
            });
        });

        /*
        ============================================================
        Hero Search Functionality
        ============================================================
        */
        const heroSearchBtn = document.getElementById('hero-search-btn');
        const heroSearchInput = document.getElementById('hero-search-input');

        if (heroSearchBtn && heroSearchInput) {
            // Handle button click
            heroSearchBtn.addEventListener('click', (e) => {
                e.preventDefault();
                const searchTerm = heroSearchInput.value.trim();
                if (searchTerm) {
                    window.location.href = `ourproperty.html?search=${encodeURIComponent(searchTerm)}`;
                }
            });

            // Handle Enter key
            heroSearchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const searchTerm = heroSearchInput.value.trim();
                    if (searchTerm) {
                        window.location.href = `ourproperty.html?search=${encodeURIComponent(searchTerm)}`;
                    }
                }
            });
        }
    </script>
</html>
